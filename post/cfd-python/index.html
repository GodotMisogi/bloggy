<!DOCTYPE html> 
<html lang="en">

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script src="//cdn.rawgit.com/paulrosen/abcjs/master/bin/abcjs_basic_3.0-min.js"></script>
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta property="og:title" content="Computational Fluid Dynamics - CFDPython">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2018-05-05">
    
    <meta property="og:description" content="">
    <meta property="og:url" content="http://godot-bloggy.me/post/cfd-python/">
    <meta property="og:site_name" content="Arjit Seth">
    
    <meta property="og:tags" content="Computational Fluid Dynamics">
    
    <meta property="og:tags" content="Programming">
    
    <meta property="og:tags" content="Mathematics">
    
    <meta name="generator" content="Hugo 0.40.2" />
    <title>Computational Fluid Dynamics - CFDPython</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://godot-bloggy.me/css/style.css">
    <link href="" rel="alternate" type="application/rss+xml" title="Arjit Seth" />
    <link href="http://godot-bloggy.me/css/prism.css" rel="stylesheet" />

    
    
    
     <link rel="shortcut icon" href="http://godot-bloggy.me//favicon.ico?" type="image/x-icon">
    
    <script src="//cdn.rawgit.com/paulrosen/abcjs/master/bin/abcjs_plugin_3.0-min.js" type="text/javascript"></script>
    <script type="text/javascript">ABCJS.plugin.hide_abc = true;</script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-89998292-1', 'auto');
    ga('send', 'pageview');
    window.baseURL = "http:\/\/godot-bloggy.me\/";
    </script>
  
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="http://godot-bloggy.me/">GOOD VIBRATIONS</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
					<li><a href="http://godot-bloggy.me/about">About</a></li>
				
					<li><a href="http://godot-bloggy.me/">Blog</a></li>
				
					<li><a href="http://godot-bloggy.me/project/">Projects</a></li>
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		
<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="http://godot-bloggy.me/">GOOD VIBRATIONS</a></h1>
		
		
		
			<small class="text-center center-block">ARJIT SETH</small>
		
		
		
			<img id="profile-pic" src="http://godot-bloggy.me//img/Logo.png" alt="My Picture" class="center-block">
		
		<div id="social" class="text-center">
			<a href="mailto:arjitseth@gmail.com"><i class="fa fa-envelope-o fa-2x"></i></a>
			<a href="https://www.linkedin.com/in/arjit-seth" target="new"><i class="fa fa-linkedin fa-2x"></i></a>
			<a href="https://github.com/GodotMisogi" target="new"><i class="fa fa-github fa-2x"></i></a>
			<a href="https://twitter.com/ArjitSeth" target="new"><i class="fa fa-twitter fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
				<a href="http://godot-bloggy.me/about">About</a>
			
				<a href="http://godot-bloggy.me/">Blog</a>
			
				<a href="http://godot-bloggy.me/project/">Projects</a>
			
		</div>
	</div>
</div>
		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<h1>Computational Fluid Dynamics - CFDPython</h1>
	</header>

	<article>
		

<p>This &lsquo;notebook&rsquo; consists of my run-through of Prof. Lorena Barba&rsquo;s &ldquo;<a href="http://lorenabarba.com/blog/cfd-python-12-steps-to-navier-stokes/">12 steps to Navier-Stokes</a>&rdquo; course, because I admit I have a problem with fluids. It is set in a &ldquo;professor first, student next&rdquo; fashion, with the student developing the stock functions with his/her own ideas. The development is presented in order of relevance to the corresponding steps rather than chronologically. Most of the partial differential equations here are numerically solved using forward difference methods in time and backward difference methods in space.<br />
Programming CFD methods is crucial in understanding how fluid solvers work because it allows one to learn about all possible points of error when running analyses through industrial software/packages, reducing debugging time in the long run.</p>

<h4 id="python-libraries">Python Libraries</h4>

<pre><code class="language-python">import numpy
import sympy
from sympy import init_printing
from sympy.utilities.lambdify import lambdify
import time, sys
from matplotlib import rc, pyplot, cm
from sympy import init_printing
from mpl_toolkits.mplot3d import Axes3D
init_printing(use_latex=True)
rc('font',**{'family':'serif'})
rc('text', usetex=True)
</code></pre>

<h3 id="step-1-1d-linear-convection"><strong>Step 1: 1D Linear Convection</strong></h3>

<h4 id="professor">Professor</h4>

<p>Partial differential equation: $$ \frac{\partial u}{\partial t} + c\frac{\partial u}{\partial x} = 0 $$</p>

<p>Discretised: $$ \frac{u^{n+1}_i - u^n_i}{\Delta t} + c\frac{u^n_i - u^n_{i-1}}{\Delta x} = 0 $$</p>

<p>Initial condition: $$ u(x,0)= \begin{cases} 2, &amp; x \in [0.5,1] \\ 1, &amp; \mathrm{everywhere\;else} \end{cases} $$</p>

<pre><code class="language-python">nx = 41
dx = 2.0/(nx-1)
nt = 20
dt = 0.025
c = 1.0

u = numpy.ones(nx)
u[int (.5/dx): int(1/dx + 1)] = 2.0
print(u)

pyplot.figure(1, figsize=(9,4), dpi=100)
pyplot.title('Professor')
pyplot.plot(numpy.linspace(0,2,nx), u)

for n in range(nt):
    un = u.copy()
    for i in range(1,nx):
        u[i] = un[i] - c*dt/dx*(un[i] - un[i-1])

pyplot.figure(2, figsize=(9,4), dpi=100)
pyplot.title('Professor')
pyplot.plot(numpy.linspace(0,2,nx), u)
pyplot.show()
</code></pre>

<pre><code>[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]
</code></pre>

<p><img src="../CFDPython_files/CFDPython_7_1.png" alt="png" /></p>

<p><img src="../CFDPython_files/CFDPython_7_2.png" alt="png" /></p>

<h4 id="student">Student</h4>

<p>No time to lose. (Down with mutability!)</p>

<pre><code class="language-python">def linearConvection(nx):
    dx = 2.0/nx
    nt = 21
    dt = 0.025
    c = 1
    
    x = numpy.linspace(0,2,nx)
    u = numpy.ones((nt,nx))
    u[0][int (.5/dx): int(1/dx +1)] = 2.0

    for n in range(nt-1):
        for i in range(1,nx):
            u[n+1][i] = u[n][i] - c*dt/dx*(u[n][i] - u[n][i-1])
    
    pyplot.figure(1,figsize=(7,3), dpi=120)
    pyplot.title('Student')
    pyplot.plot(x, u[0], label='Initial')
    pyplot.plot(x, u[nt-1], label='Final')
    pyplot.xlabel('Position (m)')
    pyplot.ylabel('Velocity (m/s)')
    pyplot.legend()

linearConvection(40)
</code></pre>

<p><img src="../CFDPython_files/CFDPython_10_0.png" alt="png" /></p>

<h3 id="step-2-1d-nonlinear-convection"><strong>Step 2: 1D Nonlinear Convection</strong></h3>

<h4 id="professor-1">Professor</h4>

<p>Partial differential equation: $$ \frac{\partial u}{\partial t} + u\frac{\partial u}{\partial x} = 0 $$</p>

<p>Discretised: $$ \frac{u^{n+1}_i - u^n_i}{\Delta t} + u^n_i\frac{u^n_i - u^n_{i-1}}{\Delta x} = 0 $$</p>

<p>Initial condition: $$ u(x,0)= \begin{cases} 2, &amp; x \in [0.5,1] \\ 1, &amp; \mathrm{everywhere\;else} \end{cases} $$</p>

<pre><code class="language-python">nx = 41
dx = 2.0/(nx-1)
nt = 20
dt = 0.025

u = numpy.ones(nx)
u[int (.5/dx): int(1/dx + 1)] = 2.0

pyplot.figure(figsize=(9,4), dpi=100)
pyplot.title('Professor')
pyplot.plot(numpy.linspace(0,2,nx), u)

for n in range(nt):
    un = u.copy()
    for i in range(1,nx):
        u[i] = un[i]*(1 - dt/dx*(un[i] - un[i-1]))

pyplot.plot(numpy.linspace(0,2,nx), u)
pyplot.show()
</code></pre>

<p><img src="../CFDPython_files/CFDPython_14_0.png" alt="png" /></p>

<h4 id="student-1">Student</h4>

<pre><code class="language-python">def nonLinearConvection(nx):
    dx = 2.0/nx
    nt = 20
    dt = 0.025
    
    x = numpy.linspace(0,2,nx)
    u = numpy.ones((nt,nx))
    u[0][int (.5/dx): int(1/dx + 1)] = 2.0

    for n in range(nt-1):
        for i in range(1,nx):
            u[n+1][i] = u[n][i]*(1 - dt/dx*(u[n][i] - u[n][i-1]))
            
    return x, u

pos, vel = nonLinearConvection(40)

# Plotting
pyplot.figure(1,figsize=(7,3), dpi=120)
pyplot.title('Student')
pyplot.plot(pos, vel[0], label='Initial')
pyplot.plot(pos, vel[-1], label='Final')
pyplot.xlabel('Position (m)')
pyplot.ylabel('Velocity (m/s)')
pyplot.legend()
pyplot.show()
</code></pre>

<p><img src="../CFDPython_files/CFDPython_16_0.png" alt="png" /></p>

<h3 id="investigation-cfl-condition"><strong>Investigation: CFL Condition</strong></h3>

<h4 id="professor-2">Professor</h4>

<p>Courant number: $$ \sigma = \frac{u\Delta t}{\Delta x} \leq \sigma_{\max} $$</p>

<pre><code class="language-python">def linearconv(nx):
    dx = 2.0/(nx-1)
    nt = 20
    c = 1.0
    sigma = 0.5
    dt = sigma*dx
    
    u = numpy.ones(nx)
    u[int (.5/dx): int(1/dx + 1)] = 2.0

    pyplot.figure(1, figsize=(9,4), dpi=100)
    pyplot.title('Professor')
    pyplot.plot(numpy.linspace(0,2,nx), u)

    for n in range(nt):
        un = u.copy()
        for i in range(1,nx):
            u[i] = un[i] - c*dt/dx*(un[i] - un[i-1])

    pyplot.plot(numpy.linspace(0,2,nx), u)

linearconv(501)
</code></pre>

<p><img src="../CFDPython_files/CFDPython_20_0.png" alt="png" /></p>

<h4 id="student-2">Student</h4>

<p>This function allows you to input the simulation time and time-step size and provides warnings if the Courant Number is greater than 1 with recommendations.</p>

<pre><code class="language-python">def linearConvectionCFL(mesh_size, time, dt):
    dx = 2.0/mesh_size
    c = 1
    time_steps = int(time/dt)
    sigma_max = dt/dx
    if sigma_max &gt; 1:
        correct_dt = dx
        print('Warning: CFL Number greater than 1. Solver will probably produce incorrect results. Maximum time-step should be %s.' %correct_dt)
    
    # Initial condition definition
    x = numpy.linspace(0,2,mesh_size)
    u = numpy.ones((time_steps,mesh_size))
    u[0][int (.5/dx): int(1/dx + 1)] = 2.0

    for n in range(time_steps-1):
        for i in range(1,mesh_size):
            u[n+1][i] = u[n][i] - c*dt/dx*(u[n][i] - u[n][i-1])
            
    return x, u
    
pos, vel = linearConvectionCFL(100, 0.2, 0.021)

# Plotting
pyplot.figure(1,figsize=(7,3), dpi=120)
pyplot.title('Student')
pyplot.plot(pos, vel[0], label='Initial')
pyplot.plot(pos, vel[-1], label='Final')
pyplot.xlabel('Position (m)')
pyplot.ylabel('Velocity (m/s)')
pyplot.legend()
pyplot.show()
</code></pre>

<pre><code>Warning: CFL Number greater than 1. Solver will probably produce incorrect results. Maximum time-step should be 0.02.
</code></pre>

<p><img src="../CFDPython_files/CFDPython_23_1.png" alt="png" /></p>

<h3 id="step-3-diffusion-equation-in-1d"><strong>Step 3: Diffusion Equation in 1D</strong></h3>

<h4 id="professor-3">Professor</h4>

<p>Partial differential equation: $$ \frac{\partial u}{\partial t} = \nu \frac{\partial^2 u}{\partial x^2} $$</p>

<p>Discretised: $$ \frac{u^{n+1}_i - u^n_i}{\Delta t} = \nu\frac{u^n_{i+1} - 2u^n_i + u^n_{i-1}}{(\Delta x)^2} $$</p>

<p>Initial condition: $$ u(x,0)= \begin{cases} 2, &amp; x \in [0.5,1] \\ 1, &amp; \mathrm{everywhere\;else} \end{cases} $$</p>

<pre><code class="language-python">nx = 41
dx = 2.0/(nx-1)
nt = 20
nu = 0.3
sigma = 0.2
dt = sigma*dx**2/nu

u = numpy.ones(nx)
u[int (.5/dx): int(1/dx + 1)] = 2.0
print(u)

pyplot.figure(1, figsize=(9,4), dpi=100)
pyplot.title('Professor')
pyplot.plot(numpy.linspace(0,2,nx), u)

for n in range(nt):
    un = u.copy()
    for i in range(1,nx - 1):
        u[i] = un[i] + nu*dt/dx**2*(un[i+1] - 2*un[i] + un[i-1] )

pyplot.plot(numpy.linspace(0,2,nx), u)
pyplot.show()
</code></pre>

<pre><code>[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]
</code></pre>

<p><img src="../CFDPython_files/CFDPython_27_1.png" alt="png" /></p>

<h4 id="student-3">Student</h4>

<p><strong>Analytical Solution of the Diffusion Equation using a Fourier Transform:</strong></p>

<p>Take the spatial Fourier transform $\mathcal F_x$ of the equation with an initial value problem:</p>

<p>$$ \frac{\partial u_F(k,t)}{\partial t} + \nu k^2 u_F(k,t) = 0 $$</p>

<p>This ODE is easily solved:<br />
$$ u_F(k,t) = u(k,0)e^{-\nu k^2 t}, \quad u(k,0) = \mathcal F_x[u(x,0)] $$</p>

<p>To find the inverse spatial Fourier transform, we invoke the convolution theorem:</p>

<p>$$ u(x,t) = \mathcal F_x^{-1}\left[u_F(k,t)\right] =  \mathcal F_x^{-1}[u(k,0)] * \mathcal F_x^{-1} \left[e^{-\nu k^2 t}\right] = u(x,0) * \mathcal F_x^{-1} \left[e^{-\nu k^2 t}\right] $$</p>

<p>The second inverse transform is the Fourier transform of a Gaussian, which is nicely found in the following manner. Let $f(k) = e^{-\nu k^2 t}$ (with $\nu$ and $t$ as parameters), now differentiate and take the Fourier transform:</p>

<p>$$ ix \cdot f(x) = -2\nu t \cdot i f&rsquo;(x) $$</p>

<p>$$ \implies f(x) = \frac{1}{\sqrt{4\pi\nu t}}\exp\left(-\frac{x^2}{4\nu t}\right) $$</p>

<p>Using the definition of convolution, the solution can be expressed as:</p>

<p>$$ u(x,t) = \frac{1}{\sqrt{4\pi\nu t}}\int_{-\infty}^{\infty} u(y,0)\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy $$</p>

<p><strong>Note:</strong> This looks strangely similar to a Green&rsquo;s function with the kernel:</p>

<p>$$ G(x,t;y) = \frac{1}{\sqrt{4\pi\nu t}}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] $$</p>

<p>Let&rsquo;s apply this solution to the current initial condition:</p>

<p>$$ \begin{align} u(x,t) &amp; =  \frac{1}{\sqrt{4\pi\nu t}}\int_{-\infty}^{0.5}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy + \frac{2}{\sqrt{4\pi\nu t}}\int_{0.5}^{1}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy \\<br />
&amp; + \frac{1}{\sqrt{4\pi\nu t}}\int_{1}^{\infty}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy \end{align}$$</p>

<p>There&rsquo;s no closed-form solution for these integrals. <code>:(</code> But these are expressible using the error function with the substitution:</p>

<p>$$ \frac{x-y}{\sqrt{4\nu t}} = u, \quad \mathrm{erf}(x) =  \frac{2}{\sqrt{\pi}}\int_{0}^{x}e^{-u^2} \mathrm du $$</p>

<p>$$ \implies  u(x,t) =  1 - \frac{1}{2}\mathrm{erf}\left(\frac{x-1}{\sqrt{4\nu t}}\right) + \frac{1}{2}\mathrm{erf}\left(\frac{x-0.5}{\sqrt{4\nu t}}\right)$$</p>

<p>We can now compare our solver&rsquo;s accuracy with this &ldquo;analytical&rdquo; solution!</p>

<p><strong>Note</strong>: This version forces the Courant Number to be 0.2 and calculates the time-step based on the mesh size accordingly for &ldquo;accurate&rdquo; results. It takes user input of simulation time and also runs a calculation using the &ldquo;analytical&rdquo; solution (via <code>sympy</code>) for comparison.</p>

<pre><code class="language-python">## Analytical solution setup using SymPy
x, t, nu = sympy.symbols('x t nu')
u_diffusion = 1 - 0.5*sympy.erf((x-1)/(sympy.sqrt(4*nu*t))) + 0.5*sympy.erf((x-0.5)/(sympy.sqrt(4*nu*t)))
u_func_diffusion = sympy.lambdify((t,x,nu), u_diffusion, modules=['numpy', 'sympy'])
</code></pre>

<pre><code class="language-python">def diffusionEquation(mesh_size, time):
    dx = 2.0/mesh_size
    nu = 0.3
    sigma_max = 0.2
    dt = sigma_max*dx**2/nu
    time_steps = int(time/dt)
    
    ## Initial condition definition
    x = numpy.linspace(0,2,mesh_size)
    u = numpy.ones((time_steps,mesh_size))
    u[0][int (.5/dx): int(1/dx + 1)] = 2.0
    u_analytical = numpy.asarray([u_func_diffusion(time_steps*dt, xi, nu) for xi in x])
    
    for n in range(time_steps-1):
        for i in range(1,mesh_size - 1):
            u[n+1][i] = u[n][i] + nu*dt/dx**2*(u[n][i+1] - 2*u[n][i] + u[n][i-1])
    
    return x, u, u_analytical

pos, vel, vel_analytical = diffusionEquation(100, 0.03333)

# Plotting
pyplot.figure(1,figsize=(7,3), dpi=120)
pyplot.title('Student')
pyplot.plot(pos, vel[0], label='Initial')
pyplot.plot(pos, vel[-1], label='Final')
pyplot.plot(pos, vel_analytical, '--', label='Analytical')
pyplot.xlabel('Position (m)')
pyplot.ylabel('Velocity (m/s)')
pyplot.legend()
pyplot.show()
</code></pre>

<p><img src="../CFDPython_files/CFDPython_32_0.png" alt="png" /></p>

<h3 id="step-4-burgers-equation"><strong>Step 4: Burgers&rsquo; Equation</strong></h3>

<h3 id="professor-4">Professor</h3>

<p>Partial differential equation:</p>

<p>$$ \frac{\partial u}{\partial t} + u\frac{\partial u}{\partial x} = \nu\frac{\partial^2 u}{\partial x^2} $$</p>

<p>Discretised: $$ \frac{u^{n+1}_i - u^n_i}{\Delta t} + u^n_i\frac{u^n_i - u^n_{i-1}}{\Delta x} = \nu\frac{u^n_{i+1} - 2u^n_i + u^n_{i-1}}{(\Delta x)^2} $$</p>

<p><strong>Student&rsquo;s modification:</strong> The notation has been clarified compared to the original presentation (including a missing condition).</p>

<p>Initial conditions (using the analytical solution):</p>

<p>$$ u(x,0) = -\frac{2\nu}{\phi}\frac{\partial\phi}{\partial x} + 4 $$</p>

<p>$$ \phi(x,0) = \exp\left(\frac{-x^2}{4\nu}\right) + \exp\left(\frac{-(x-2\pi)^2}{4\nu}\right) $$</p>

<p>Boundary conditions: $$ u(0,t) = u(2\pi,t), \quad u&rsquo;(0,t) = u&rsquo;(2\pi, t)$$</p>

<pre><code class="language-python">## Analytical solution setup using SymPy
x, t, nu = sympy.symbols('x t nu')
phi = sympy.exp(-(x-4*t)**2/(4*nu*(t+1))) + sympy.exp(-(x-4*t-2*numpy.pi)**2/(4*nu*(t+1)))
diffphi = sympy.diff(phi, x)
u = -2*nu/phi*diffphi + 4
ufunc = sympy.lambdify((t,x,nu), u)
</code></pre>

<pre><code class="language-python">nx = 81
dx = 2.0*numpy.pi/(nx-1)
nt = 100
nu = 0.07
dt = dx*nu

x = numpy.linspace(0, 2*numpy.pi,nx)
un = numpy.empty(nx)
t = 0

u = numpy.asarray([ufunc(t,x0,nu) for x0 in x])

pyplot.figure(figsize=(9, 4),dpi=100)
pyplot.title('Professor')
pyplot.plot(x, u, marker='o', lw=2)
pyplot.xlim([0, 2 * numpy.pi])
pyplot.ylim([0, 10])

for n in range(nt):
    un = u.copy()
    for i in range(1,nx-1):
        u[i] = un[i]*(1-dt/dx*(un[i] - un[i-1])) + nu*dt/dx**2*(un[i+1] - 2*un[i] + un[i-1])
    u[0] = un[0]*(1-dt/dx*(un[0] - un[-2])) + nu*dt/dx**2*(un[1] - 2*un[0] + un[-2])
    u[-1] = u[0]

u_analytical = numpy.asarray([ufunc(nt*dt, xi, nu) for xi in x])

# Plotting
pyplot.figure(figsize=(9, 4),dpi=100)
pyplot.plot(x, u, marker='o', lw=2, label='Computational')
pyplot.plot(x, u_analytical, label='Analytical')
pyplot.xlim([0, 2 * numpy.pi])
pyplot.ylim([0, 10])
pyplot.legend()
pyplot.show()
</code></pre>

<p><img src="../CFDPython_files/CFDPython_35_0.png" alt="png" /></p>

<p><img src="../CFDPython_files/CFDPython_35_1.png" alt="png" /></p>

<h4 id="student-4">Student</h4>

<pre><code class="language-python">def burgersEquation(mesh_size, time):
    dx = 2.0*numpy.pi/(mesh_size-1)
    nu = 0.07
    dt = dx*nu
    timesteps = int(time/dt)
    
    x = numpy.linspace(0, 2*numpy.pi, mesh_size)
    u = numpy.empty((timesteps,mesh_size))
    u_analytical = numpy.asarray([ufunc(timesteps*dt, xi, nu) for xi in x])
    
    u[0] = numpy.asarray([ufunc(0,x0,nu) for x0 in x])
    
    for n in range(timesteps-1):
        for i in range(1,mesh_size-1):
            u[n+1][i] = u[n][i]*(1-dt/dx*(u[n][i] - u[n][i-1])) + nu*dt/dx**2*(u[n][i+1] - 2*u[n][i] + u[n][i-1]) 
            u[n+1][0] = u[n][0]*(1-dt/dx*(u[n][0] - u[n][-2])) + nu*dt/dx**2*(u[n][1] - 2*u[n][0] + u[n][-2])
            u[n+1][-1] = u[n+1][0]
    
    return x, u, u_analytical

pos, vel, vel_analytical = burgersEquation(101,0.5)

# Plotting
pyplot.figure(1,figsize=(7,4), dpi=120)
pyplot.title('Student')
pyplot.plot(pos, vel[0], marker='o', lw=2, label = 'Initial')
pyplot.plot(pos, vel[-1], marker='o', lw=2, label='Computational Result')
pyplot.plot(pos, vel_analytical, label='Analytical Result')
pyplot.xlabel('Position (m)')
pyplot.ylabel('Velocity (m/s)')
pyplot.xlim([0, 2*numpy.pi])
pyplot.ylim([0, 10])
pyplot.legend()
pyplot.show()
</code></pre>

<p><img src="../CFDPython_files/CFDPython_37_0.png" alt="png" /></p>

<h3 id="aside-kardar-parisi-zhang-equation"><strong>Aside: Kardar–Parisi–Zhang equation</strong></h3>

<h4 id="student-5">Student</h4>

<p>The KPZ equation is a generalisation of Burgers&rsquo; equation to multiple dimensions. Write Burgers&rsquo; equation in the form:</p>

<p>$$ \frac{\partial u}{\partial t} + \frac{1}{2}\frac{\partial u^2}{\partial x} = \nu\frac{\partial^2 u}{\partial x^2} $$</p>

<p>Let $ u = \psi_x $, then Burgers&rsquo; equation becomes:</p>

<p>$$ \psi_{tx} + \psi_x\psi_{xx} = \nu\psi_{xxx} $$</p>

<p>$$ \partial_x\left(\psi_t + \frac{\psi_x^2}{2} \right) = \nu\partial_x(\psi_{xx}) $$</p>

<p>Integrating with respect to x gives the following equation:</p>

<p>$$ \frac{\partial \psi}{\partial t} + \frac{1}{2}\left(\frac{\partial \psi}{\partial x}\right)^2 = \nu\frac{\partial^2 \psi}{\partial x^2} $$</p>

<p>This is the KPZ equation in one dimension, which seemingly generalises to:</p>

<p>$$ \frac{\partial \psi}{\partial t} + \frac{\lambda}{2}\left(\nabla \psi\right)^2 = \nu\nabla^2 \psi $$</p>

<p>Whatever &ldquo;$(\nabla \psi)^2$&rdquo; means. Let $\lambda = 2$ and take the one-dimensional case, then the equation has an integrating factor (thanks to Vyn from freenode&rsquo;s <code>##math</code>!), which allows it to be written in the form of the 1D diffusion equation:</p>

<p>$$ \frac{\partial}{\partial t}\left[\exp\left(-\frac{\psi}{\nu}\right)\right] = \nu\frac{\partial^2}{\partial x^2}\left[\exp\left(-\frac{\psi}{\nu}\right)\right] $$</p>

<p>TODO: Add solution.</p>

<h3 id="step-5-2d-linear-convection"><strong>Step 5: 2D Linear Convection</strong></h3>

<h4 id="professor-5">Professor</h4>

<p>Partial differential equation: $$ \frac{\partial u}{\partial t} + c\left(\frac{\partial u}{\partial x} + \frac{\partial u}{\partial y} \right) = 0 $$</p>

<p>Discretised: $$ \frac{u^{n+1}_{i,j} - u^n_{i,j}}{\Delta t} + c\left(\frac{u^n_{i,j} - u^n_{i-1,j}}{\Delta x} + \frac{u^n_{i,j} - u^n_{i,j-1}}{\Delta y}\right) = 0 $$`</p>

<p><strong>Student&rsquo;s modification:</strong> This has been modified into a function to take one input with two options, a &ldquo;fast&rdquo; (which uses array operations with NumPy) and a &ldquo;slow&rdquo; (which uses <code>for</code> loops). For fast, input <code>1</code> into the function, otherwise input any other number for slow. <code>timeit</code> has been imported to clock the processing speeds of each variant.</p>

<pre><code class="language-python">import timeit

def linearconv2D(speed):
    nx = 81
    ny = 81
    dx = 2.0/(nx - 1)
    dy = 2.0/(ny - 1)
    c = 1
    sigma = 0.2
    nt = 100
    dt = sigma*dx
    x = numpy.linspace(0, 2, nx)
    y = numpy.linspace(0, 2, ny)
    
    u = numpy.ones((ny,nx))
    un = numpy.ones((ny,nx))
    u[int(0.5/dy):int(1.0/dy + 1),int(.5/dx):int(1.0/dx + 1)] = 2 
    
    fig = pyplot.figure(figsize=(9,7),dpi=100)
    ax = fig.gca(projection='3d')
    X, Y = numpy.meshgrid(x,y)
    surf = ax.plot_surface(X, Y, u[:], cmap=cm.viridis)
    
    if speed == 1:
        tick = timeit.default_timer()
        for n in range(nt + 1):
            un = u.copy()
            u[1:,1:] = u[1:,1:] - c*dt*((u[1:,1:] - u[:-1,1:])/dx + (u[1:,1:] - u[1:,:-1])/dy)
            u[0,:] = 1
            u[-1,:] = 1
            u[:,0] = 1
            u[:,-1] = 1
        tock = timeit.default_timer()
        print('Array operations took %s seconds' %(tock - tick))
    else:
        tick = timeit.default_timer()
        for n in range(nt + 1):
            un = u.copy()
            row, col = u.shape
            for j in range(1, row):
                for i in range(1, col):
                    u[j,i] = un[j,i] - c*dt*((un[j,i] - un[j,i-1])/dx + (un[j,i] - un[j-1,i])/dy)
                    u[0,:] = 1
                    u[-1,:] = 1
                    u[:,0] = 1
                    u[:,-1] = 1
        tock = timeit.default_timer()
        print('For loops took %s seconds' %(tock - tick))
        
    fig = pyplot.figure(figsize=(9, 7), dpi=100)
    ax = fig.gca(projection='3d')
    surf2 = ax.plot_surface(X, Y, u[:], cmap=cm.viridis)
    
linearconv2D(1)
linearconv2D(0)
</code></pre>

<pre><code>Array operations took 0.011439886002335697 seconds
For loops took 3.0533901620074175 seconds
</code></pre>

<p><img src="../CFDPython_files/CFDPython_45_1.png" alt="png" /></p>

<p><img src="../CFDPython_files/CFDPython_45_2.png" alt="png" /></p>

<h4 id="student-6">Student</h4>

<p>This function takes the mesh size in each direction as separate inputs and also the required simulation time. It minimises the time-step based on the smaller grid distance between <code>x</code> and <code>y</code> for accuracy (at the cost of speed!).</p>

<pre><code class="language-python">def linearConvection2D(mesh_size_x, mesh_size_y, time):
    dx = 2/(mesh_size_x - 1)
    dy = 2/(mesh_size_y - 1)
    c = 1
    sigma = 0.2
    dt = sigma*min(dx,dy)
    timesteps = int(time/dt)
    
    x = numpy.linspace(0,2, mesh_size_x)
    y = numpy.linspace(0,2, mesh_size_y)
    
    u = numpy.ones((timesteps, mesh_size_x, mesh_size_y))
    u[0][int(0.5/dy):int(1.0/dy + 1),int(.5/dx):int(1.0/dx + 1)] = 2
    
    for n in range(timesteps-1):
        u[n+1][1:,1:] = u[n][1:,1:] - c*dt*((u[n][1:,1:] - u[n][:-1,1:])/dx + (u[n][1:,1:] - u[n][1:,:-1])/dy)
        u[n+1][0,:] = 1
        u[n+1][-1,:] = 1
        u[n+1][:,0] = 1
        u[n+1][:,-1] = 1
        
    return x, y, u
    
pos_x, pos_y, vel = linearConvection2D(201, 201, 2.5/5.0)

# Plotting
fig = pyplot.figure(1, figsize=(9,7), dpi=100)
ax = fig.gca(projection='3d')
X, Y = numpy.meshgrid(pos_x, pos_y)
surf = ax.plot_surface(X, Y, vel[0], cmap=cm.viridis)

fig2 = pyplot.figure(2, figsize=(9,7), dpi=100)
ax = fig2.gca(projection='3d')
X, Y = numpy.meshgrid(pos_x, pos_y)
surf2 = ax.plot_surface(X, Y, vel[-1], cmap=cm.viridis)
pyplot.show()
</code></pre>

<p><img src="../CFDPython_files/CFDPython_48_0.png" alt="png" /></p>

<p><img src="../CFDPython_files/CFDPython_48_1.png" alt="png" /></p>

<p>More to come soon!</p>

	</article>
</main>

<div id="bottom-nav" class="text-center center-block">
	<a href=" http://godot-bloggy.me/" class="btn btn-default"><i class="fa fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "godotmisogi" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
   <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  <script src="http://godot-bloggy.me/js/App.js"></script>
  
  
  <script src="http://godot-bloggy.me/js/prism.js"></script>
  
  </body>
</html>
