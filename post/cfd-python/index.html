<!DOCTYPE html> 
<html lang="en">

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script src="//cdn.rawgit.com/paulrosen/abcjs/master/bin/abcjs_basic_3.0-min.js"></script>
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# website: http://ogp.me/ns/website#">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta property="og:title" content="Computational Fluid Dynamics - CFDPython">
    
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2018-05-05">
    
    <meta property="og:description" content="">
    <meta property="og:url" content="https://godot-bloggy.xyz/post/cfd-python/">
    <meta property="og:site_name" content="Arjit Seth">
    
    <meta property="og:tags" content="Computational Fluid Dynamics">
    
    <meta property="og:tags" content="Programming">
    
    <meta property="og:tags" content="Mathematics">
    
    <meta name="generator" content="Hugo 0.68.3" />
    <title>Computational Fluid Dynamics - CFDPython</title>
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://godot-bloggy.xyz/css/style.css">
    <link href="" rel="alternate" type="application/rss+xml" title="Arjit Seth" />
    <link href="https://godot-bloggy.xyz/css/prism.css" rel="stylesheet" />

    
    
    
     <link rel="shortcut icon" href="https://godot-bloggy.xyz//pp.jpg?" type="image/x-icon">
    
    <script src="//cdn.rawgit.com/paulrosen/abcjs/master/bin/abcjs_plugin_3.0-min.js" type="text/javascript"></script>
    <script type="text/javascript">ABCJS.plugin.hide_abc = true;</script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-89998292-1', 'auto');
    ga('send', 'pageview');
    window.baseURL = "https:\/\/godot-bloggy.xyz\/";
    </script>
  
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top visible-xs">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
				<a class="navbar-brand" href="https://godot-bloggy.xyz/">｢ALL FICTION｣</a>
			
		</div>
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				
				
					<li><a href="https://godot-bloggy.xyz/about">About</a></li>
				
					<li><a href="https://godot-bloggy.xyz/">Blog</a></li>
				
					<li><a href="https://godot-bloggy.xyz/project/">Projects</a></li>
				
			</ul>
		</div>
	</div>
</nav>
<div class="container-fluid">
	<div class="row">
		
<div id="menu" class="hidden-xs col-sm-4 col-md-3">
	<div id="menu-content" class="vertical-align">
		
			<h1 class="text-center"><a href="https://godot-bloggy.xyz/">｢ALL FICTION｣</a></h1>
		
		
		
			<small class="text-center center-block">ARJIT SETH</small>
		
		
		
			<img id="profile-pic" src="https://godot-bloggy.xyz//img/Logo.png" alt="My Picture" class="center-block">
		
		<div id="social" class="text-center">
			<a href="mailto:arjitseth@gmail.com"><i class="fa fa-envelope-o fa-2x"></i></a>
			<a href="https://www.linkedin.com/in/arjit-seth" target="new"><i class="fa fa-linkedin fa-2x"></i></a>
			<a href="https://github.com/GodotMisogi" target="new"><i class="fa fa-github fa-2x"></i></a>
			<a href="https://twitter.com/ArjitSeth" target="new"><i class="fa fa-twitter fa-2x"></i></a>
		</div>
		<div id="links" class="text-center">
			
			
				<a href="https://godot-bloggy.xyz/about">About</a>
			
				<a href="https://godot-bloggy.xyz/">Blog</a>
			
				<a href="https://godot-bloggy.xyz/project/">Projects</a>
			
		</div>
	</div>
</div>
		<div id="content" class="col-xs-12 col-sm-8 col-md-9">
			<div class="row">
				<div id="post" class="col-sm-offset-1 col-sm-10 col-md-10 col-lg-8">

<main>
	<header>
		<h1>Computational Fluid Dynamics - CFDPython</h1>
	</header>

	<article>
		<p>This &lsquo;notebook&rsquo; consists of my run-through of Prof. Lorena Barba&rsquo;s &ldquo;<a href="http://lorenabarba.com/blog/cfd-python-12-steps-to-navier-stokes/">12 steps to Navier-Stokes</a>&rdquo; course, because I admit I have a problem with fluids. The <a href="https://www.grc.nasa.gov/www/k-12/airplane/nseqs.html">Navier-Stokes</a> equations that will be solved in this notebook are the following in conservative form:</p>
<p>$$ \frac{\partial \rho}{\partial t} + \nabla \cdot \left(\rho V\right) = 0 $$</p>
<p>$$ \frac{\partial (\rho\vec V)}{\partial t} + \nabla \cdot \left(\rho ,\vec V \otimes \vec V + p\hat I \right) = \rho \vec g + \nabla \cdot \hat \tau + \vec f$$</p>
<p>where $\rho$ is the density of the fluid, $\vec V$ denotes the velocity, $p$ denotes the pressure, $\tau$ denotes the stresses, and $f$ denotes body forces. The flows in this tutorial are incompressible cases in which the density is considered constant, so the energy equation is not solved.</p>
<p>The goal of this exercise to solve these equations numerically for some simple cases, starting from the ground-up. It is set in a &ldquo;professor first, student next&rdquo; fashion, with the student developing the stock functions with his/her own ideas. The development is presented in order of relevance to the corresponding steps rather than chronologically. Most of the partial differential equations here are numerically solved using forward difference methods in time and backward difference methods in space.</p>
<p>Programming CFD methods is crucial in understanding how fluid solvers work because it allows one to learn about all possible points of error when running analyses through industrial software/packages, reducing debugging time in the long run.</p>
<h4 id="python-libraries">Python Libraries</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy
<span style="color:#f92672">import</span> sympy
<span style="color:#f92672">from</span> sympy <span style="color:#f92672">import</span> init_printing
<span style="color:#f92672">from</span> sympy.utilities.lambdify <span style="color:#f92672">import</span> lambdify
<span style="color:#f92672">import</span> time<span style="color:#f92672">,</span> sys
<span style="color:#f92672">from</span> matplotlib <span style="color:#f92672">import</span> rc, pyplot, cm
<span style="color:#f92672">from</span> sympy <span style="color:#f92672">import</span> init_printing
<span style="color:#f92672">from</span> mpl_toolkits.mplot3d <span style="color:#f92672">import</span> Axes3D
<span style="color:#f92672">import</span> timeit
init_printing(use_latex<span style="color:#f92672">=</span>True)
rc(<span style="color:#e6db74">&#39;font&#39;</span>,<span style="color:#f92672">**</span>{<span style="color:#e6db74">&#39;family&#39;</span>:<span style="color:#e6db74">&#39;serif&#39;</span>})
rc(<span style="color:#e6db74">&#39;text&#39;</span>, usetex<span style="color:#f92672">=</span>True)
</code></pre></div><h3 id="step-1-1d-linear-convection"><strong>Step 1: 1D Linear Convection</strong></h3>
<h4 id="professor">Professor</h4>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial u}{\partial t} + c\frac{\partial u}{\partial x} = 0 $$</p>
<p>Discretised:</p>
<p>$$ \frac{u^{n+1}_i - u^n_i}{\Delta t} + c\frac{u^n_i - u^n_{i-1}}{\Delta x} = 0 $$</p>
<p>Initial condition:</p>
<p>$$ u(x,0)= \begin{cases} 2, &amp; x \in [0.5,1] \\ 1, &amp; \mathrm{everywhere;else} \end{cases} $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
dt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.025</span>
c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones(nx)
u[int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
<span style="color:#66d9ef">print</span>(u)

pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">4</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)

<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt):
    un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,nx):
        u[i] <span style="color:#f92672">=</span> un[i] <span style="color:#f92672">-</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(un[i] <span style="color:#f92672">-</span> un[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">4</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><pre><code>[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]
</code></pre>
<p><img src="../CFDPython_files/1DConvectionInitProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/1DConvectionProf.svg" alt="svg"></p>
<h4 id="student">Student</h4>
<p>No time to lose. (Down with mutability!)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linearConvection</span>(nx):
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>nx
    nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>
    dt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.025</span>
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx)
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((nt,nx))
    u[<span style="color:#ae81ff">0</span>][int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>

    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,nx):
            u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">=</span> u[n][i] <span style="color:#f92672">-</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(u[n][i] <span style="color:#f92672">-</span> u[n][i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
    
    pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)
    pyplot<span style="color:#f92672">.</span>plot(x, u[<span style="color:#ae81ff">0</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Initial&#39;</span>)
    pyplot<span style="color:#f92672">.</span>plot(x, u[nt<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Final&#39;</span>)
    pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Position (m)&#39;</span>)
    pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Velocity (m/s)&#39;</span>)
    pyplot<span style="color:#f92672">.</span>legend()

linearConvection(<span style="color:#ae81ff">40</span>)
</code></pre></div><p><img src="../CFDPython_files/1DConvectionStud.svg" alt="svg"></p>
<h3 id="step-2-1d-nonlinear-convection"><strong>Step 2: 1D Nonlinear Convection</strong></h3>
<h4 id="professor-1">Professor</h4>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial u}{\partial t} + u\frac{\partial u}{\partial x} = 0 $$</p>
<p>Discretised:</p>
<p>$$ \frac{u^{n+1}_i - u^n_i}{\Delta t} + u^n_i\frac{u^n_i - u^n_{i-1}}{\Delta x} = 0 $$</p>
<p>Initial condition:</p>
<p>$$ u(x,0)= \begin{cases} 2, &amp; x \in [0.5,1] \\ 1, &amp; \mathrm{everywhere;else} \end{cases} $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
dt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.025</span>

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones(nx)
u[int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>

pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">4</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)

<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt):
    un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,nx):
        u[i] <span style="color:#f92672">=</span> un[i]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(un[i] <span style="color:#f92672">-</span> un[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))

pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/1DNLConvectionProf.svg" alt="svg"></p>
<h4 id="student-1">Student</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">nonLinearConvection</span>(nx):
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>nx
    nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
    dt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.025</span>
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx)
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((nt,nx))
    u[<span style="color:#ae81ff">0</span>][int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>

    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,nx):
            u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">=</span> u[n][i]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(u[n][i] <span style="color:#f92672">-</span> u[n][i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
            
    <span style="color:#66d9ef">return</span> x, u

pos, vel <span style="color:#f92672">=</span> nonLinearConvection(<span style="color:#ae81ff">40</span>)

<span style="color:#75715e"># Plotting</span>
pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#ae81ff">0</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Initial&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Final&#39;</span>)
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Position (m)&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Velocity (m/s)&#39;</span>)
pyplot<span style="color:#f92672">.</span>legend()
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/1DNLConvectionStud.svg" alt="svg"></p>
<h3 id="investigation-cfl-condition"><strong>Investigation: CFL Condition</strong></h3>
<h4 id="professor-2">Professor</h4>
<p>Courant number:</p>
<p>$$ \sigma = \frac{u\Delta t}{\Delta x} \leq \sigma_{\max} $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linearconv</span>(nx):
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
    dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>dx
    
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones(nx)
    u[int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>

    pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">4</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
    pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)

    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt):
        un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,nx):
            u[i] <span style="color:#f92672">=</span> un[i] <span style="color:#f92672">-</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(un[i] <span style="color:#f92672">-</span> un[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

    pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)

linearconv(<span style="color:#ae81ff">501</span>)
</code></pre></div><p><img src="../CFDPython_files/1DCFLProf.svg" alt="svg"></p>
<h4 id="student-2">Student</h4>
<p>This function allows you to input the simulation time and time-step size and provides warnings if the Courant Number is greater than 1 with recommendations.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linearConvectionCFL</span>(mesh_size, time, dt):
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>mesh_size
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    time_steps <span style="color:#f92672">=</span> int(time<span style="color:#f92672">/</span>dt)
    sigma_max <span style="color:#f92672">=</span> dt<span style="color:#f92672">/</span>dx
    <span style="color:#66d9ef">if</span> sigma_max <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        correct_dt <span style="color:#f92672">=</span> dx
        <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;Warning: CFL Number greater than 1. Solver will probably produce incorrect results. Maximum time-step should be {correct_dt}&#39;</span>)
    
    <span style="color:#75715e"># Initial condition definition</span>
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,mesh_size)
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((time_steps,mesh_size))
    u[<span style="color:#ae81ff">0</span>][int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>

    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(time_steps<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,mesh_size):
            u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">=</span> u[n][i] <span style="color:#f92672">-</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(u[n][i] <span style="color:#f92672">-</span> u[n][i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
            
    <span style="color:#66d9ef">return</span> x, u
    
pos, vel <span style="color:#f92672">=</span> linearConvectionCFL(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">0.021</span>)

<span style="color:#75715e"># Plotting</span>
pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#ae81ff">0</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Initial&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Final&#39;</span>)
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Position (m)&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Velocity (m/s)&#39;</span>)
pyplot<span style="color:#f92672">.</span>legend()
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><pre><code>Warning: CFL Number greater than 1. Solver will probably produce incorrect results. Maximum time-step should be 0.02.
</code></pre>
<p><img src="../CFDPython_files/1DCFLStud.svg" alt="svg"></p>
<h3 id="step-3-diffusion-equation-in-1d"><strong>Step 3: Diffusion Equation in 1D</strong></h3>
<h4 id="professor-3">Professor</h4>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial u}{\partial t} = \nu \frac{\partial^2 u}{\partial x^2} $$</p>
<p>Discretised:</p>
<p>$$ \frac{u^{n+1}_i - u^n_i}{\Delta t} = \nu\frac{u^n_{i+1} - 2u^n_i + u^n_{i-1}}{(\Delta x)^2} $$</p>
<p>Initial condition:</p>
<p>$$ u(x,0)= \begin{cases} 2, &amp; x \in [0.5,1] \\ 1, &amp; \mathrm{everywhere;else} \end{cases} $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>
dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span>nu

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones(nx)
u[int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
<span style="color:#66d9ef">print</span>(u)

pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">4</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)

<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt):
    un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,nx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>):
        u[i] <span style="color:#f92672">=</span> un[i] <span style="color:#f92672">+</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(un[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>un[i] <span style="color:#f92672">+</span> un[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] )

pyplot<span style="color:#f92672">.</span>plot(numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx), u)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><pre><code>[1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 2. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]
</code></pre>
<p><img src="../CFDPython_files/1DDiffusionProf.svg" alt="svg"></p>
<h4 id="student-3">Student</h4>
<p><strong>Analytical Solution of the Diffusion Equation using a Fourier Transform:</strong></p>
<p>Take the spatial Fourier transform $\mathcal F_x$ of the equation with an initial value problem:</p>
<p>$$ \frac{\partial u_F(k,t)}{\partial t} + \nu k^2 u_F(k,t) = 0 $$</p>
<p>This ODE is easily solved:</p>
<p>$$ u_F(k,t) = u(k,0)e^{-\nu k^2 t}, \quad u(k,0) = \mathcal F_x[u(x,0)] $$</p>
<p>To find the inverse spatial Fourier transform, we invoke the convolution theorem:</p>
<p>$$ u(x,t) = \mathcal F_x^{-1}\left[u_F(k,t)\right] =  \mathcal F_x^{-1}[u(k,0)] * \mathcal F_x^{-1} \left[e^{-\nu k^2 t}\right] = u(x,0) * \mathcal F_x^{-1} \left[e^{-\nu k^2 t}\right] $$</p>
<p>The second inverse transform is the Fourier transform of a Gaussian, which is nicely found in the following manner. Let $f(k) = e^{-\nu k^2 t}$ (with $\nu$ and $t$ as parameters), now differentiate and take the Fourier transform:</p>
<p>$$ ix \cdot f(x) = -2\nu t \cdot i f&rsquo;(x) $$</p>
<p>$$ \implies f(x) = \frac{1}{\sqrt{4\pi\nu t}}\exp\left(-\frac{x^2}{4\nu t}\right) $$</p>
<p>Using the definition of convolution, the solution can be expressed as:</p>
<p>$$ u(x,t) = \frac{1}{\sqrt{4\pi\nu t}}\int_{-\infty}^{\infty} u(y,0)\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy $$</p>
<p><strong>Note:</strong> This looks strangely similar to a Green&rsquo;s function with the kernel:</p>
<p>$$ G(x,t;y,t) = \frac{1}{\sqrt{4\pi\nu t}}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] $$</p>
<p>Let&rsquo;s apply this solution to the current initial condition:</p>
<p>$$ \begin{align} u(x,t) &amp; =  \frac{1}{\sqrt{4\pi\nu t}}\int_{-\infty}^{0.5}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy + \frac{2}{\sqrt{4\pi\nu t}}\int_{0.5}^{1}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy \\\<br>
&amp; + \frac{1}{\sqrt{4\pi\nu t}}\int_{1}^{\infty}\exp\left[-\frac{(x-y)^2}{4\nu t}\right] \mathrm dy \end{align}$$</p>
<p>There&rsquo;s no closed-form solution for these integrals. <code>:(</code> But these are expressible using the error function with the substitution:</p>
<p>$$ \frac{x-y}{\sqrt{4\nu t}} = u, \quad \mathrm{erf}(x) =  \frac{2}{\sqrt{\pi}}\int_{0}^{x}e^{-u^2} \mathrm du $$</p>
<p>$$ \implies  u(x,t) =  1 - \frac{1}{2}\mathrm{erf}\left(\frac{x-1}{\sqrt{4\nu t}}\right) + \frac{1}{2}\mathrm{erf}\left(\frac{x-0.5}{\sqrt{4\nu t}}\right)$$</p>
<p>We can now compare our solver&rsquo;s accuracy with this &ldquo;analytical&rdquo; solution!</p>
<p><strong>Note</strong>: This version forces the Courant Number to be 0.2 and calculates the time-step based on the mesh size accordingly for &ldquo;accurate&rdquo; results. It takes user input of simulation time and also runs a calculation using the &ldquo;analytical&rdquo; solution (via <code>sympy</code>) for comparison.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">## Analytical solution setup using SymPy</span>
x, t, nu <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>symbols(<span style="color:#e6db74">&#39;x t nu&#39;</span>)
u_diffusion <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span>sympy<span style="color:#f92672">.</span>erf((x<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">/</span>(sympy<span style="color:#f92672">.</span>sqrt(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>nu<span style="color:#f92672">*</span>t))) <span style="color:#f92672">+</span> 
              <span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span>sympy<span style="color:#f92672">.</span>erf((x<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>)<span style="color:#f92672">/</span>(sympy<span style="color:#f92672">.</span>sqrt(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>nu<span style="color:#f92672">*</span>t))))
u_func_diffusion <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>lambdify((t,x,nu), u_diffusion, modules<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;numpy&#39;</span>, <span style="color:#e6db74">&#39;sympy&#39;</span>])
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">diffusionEquation</span>(mesh_size, time):
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>mesh_size
    nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
    sigma_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>
    dt <span style="color:#f92672">=</span> sigma_max<span style="color:#f92672">*</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span>nu
    time_steps <span style="color:#f92672">=</span> int(time<span style="color:#f92672">/</span>dt)
    
    <span style="color:#75715e">## Initial condition definition</span>
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,mesh_size)
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((time_steps,mesh_size))
    u[<span style="color:#ae81ff">0</span>][int (<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx): int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
    u_analytical <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>asarray([u_func_diffusion(time_steps<span style="color:#f92672">*</span>dt, xi, nu) <span style="color:#66d9ef">for</span> xi <span style="color:#f92672">in</span> x])
    
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(time_steps<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,mesh_size <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>):
            u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">=</span> u[n][i] <span style="color:#f92672">+</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(u[n][i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u[n][i] <span style="color:#f92672">+</span> u[n][i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
    
    <span style="color:#66d9ef">return</span> x, u, u_analytical

pos, vel, vel_analytical <span style="color:#f92672">=</span> diffusionEquation(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">0.03333</span>)

<span style="color:#75715e"># Plotting</span>
pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">3</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#ae81ff">0</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Initial&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Final&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel_analytical, <span style="color:#e6db74">&#39;--&#39;</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Analytical&#39;</span>)
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Position (m)&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Velocity (m/s)&#39;</span>)
pyplot<span style="color:#f92672">.</span>legend()
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/1DDiffusionStud.svg" alt="svg"></p>
<h3 id="step-4-burgers-equation"><strong>Step 4: Burgers&rsquo; Equation</strong></h3>
<h3 id="professor-4">Professor</h3>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial u}{\partial t} + u\frac{\partial u}{\partial x} = \nu\frac{\partial^2 u}{\partial x^2} $$</p>
<p>Discretised:</p>
<p>$$ \frac{u^{n+1}_i - u^n_i}{\Delta t} + u^n_i\frac{u^n_i - u^n_{i-1}}{\Delta x} = \nu\frac{u^n_{i+1} - 2u^n_i + u^n_{i-1}}{(\Delta x)^2} $$</p>
<p><strong>Student&rsquo;s modification:</strong> The notation has been clarified compared to the original presentation (including a missing condition).</p>
<p>Initial conditions (using the analytical solution):</p>
<p>$$ \phi(x,t)_{t=0} = \exp\left[-\frac{\left(x - 4t - 2\pi\right)^{2}}{4 \nu \left(t + 1\right)}\right] + \exp\left[- \frac{\left(x-4t\right)^{2}}{4 \nu \left(t + 1\right)}\right] $$</p>
<p>$$ u(x,0) = -\frac{2\nu}{\phi}\frac{\partial\phi}{\partial x} + 4 $$</p>
<p>Boundary conditions:</p>
<p>$$ u(0,t) = u(2\pi,t), \quad u&rsquo;(0,t) = u&rsquo;(2\pi, t)$$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">## Analytical solution setup using SymPy</span>
x, t, nu <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>symbols(<span style="color:#e6db74">&#39;x t nu&#39;</span>)
phi <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>t)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>nu<span style="color:#f92672">*</span>(t<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>))) <span style="color:#f92672">+</span> sympy<span style="color:#f92672">.</span>exp(<span style="color:#f92672">-</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>t<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>numpy<span style="color:#f92672">.</span>pi)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>nu<span style="color:#f92672">*</span>(t<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)))
diffphi <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>diff(phi, x)
u <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>nu<span style="color:#f92672">/</span>phi<span style="color:#f92672">*</span>diffphi <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>
ufunc <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>lambdify((t,x,nu), u)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">81</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>numpy<span style="color:#f92672">.</span>pi<span style="color:#f92672">/</span>(nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.07</span>
dt <span style="color:#f92672">=</span> dx<span style="color:#f92672">*</span>nu

x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>numpy<span style="color:#f92672">.</span>pi,nx)
un <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>empty(nx)
t <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>asarray([ufunc(t,x0,nu) <span style="color:#66d9ef">for</span> x0 <span style="color:#f92672">in</span> x])

pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">4</span>) dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(x, u, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
pyplot<span style="color:#f92672">.</span>xlim([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> numpy<span style="color:#f92672">.</span>pi])
pyplot<span style="color:#f92672">.</span>ylim([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>])

<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt):
    un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        u[i] <span style="color:#f92672">=</span> un[i]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(un[i] <span style="color:#f92672">-</span> un[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])) <span style="color:#f92672">+</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(un[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>un[i] <span style="color:#f92672">+</span> un[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
    u[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> un[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(un[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> un[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])) <span style="color:#f92672">+</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(un[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>un[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> un[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
    u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> u[<span style="color:#ae81ff">0</span>]

u_analytical <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>asarray([ufunc(nt<span style="color:#f92672">*</span>dt, xi, nu) <span style="color:#66d9ef">for</span> xi <span style="color:#f92672">in</span> x])

<span style="color:#75715e"># Plotting</span>
pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">4</span>) dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>plot(x, u, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Computational&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(x, u_analytical, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Analytical&#39;</span>)
pyplot<span style="color:#f92672">.</span>xlim([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> numpy<span style="color:#f92672">.</span>pi])
pyplot<span style="color:#f92672">.</span>ylim([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>])
pyplot<span style="color:#f92672">.</span>legend()
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/1DBurgerInitProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/1DBurgerProf.svg" alt="svg"></p>
<h4 id="student-4">Student</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">burgersEquation</span>(mesh_size, time):
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>numpy<span style="color:#f92672">.</span>pi<span style="color:#f92672">/</span>(mesh_size<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.07</span>
    dt <span style="color:#f92672">=</span> dx<span style="color:#f92672">*</span>nu
    timesteps <span style="color:#f92672">=</span> int(time<span style="color:#f92672">/</span>dt)
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>numpy<span style="color:#f92672">.</span>pi, mesh_size)
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>empty((timesteps,mesh_size))
    u_analytical <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>asarray([ufunc(timesteps<span style="color:#f92672">*</span>dt, xi, nu) <span style="color:#66d9ef">for</span> xi <span style="color:#f92672">in</span> x])
    
    u[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>asarray([ufunc(<span style="color:#ae81ff">0</span>,x0,nu) <span style="color:#66d9ef">for</span> x0 <span style="color:#f92672">in</span> x])
    
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(timesteps<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,mesh_size<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
            u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">=</span> (u[n][i]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(u[n][i] <span style="color:#f92672">-</span> u[n][i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])) 
                       <span style="color:#f92672">+</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(u[n][i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u[n][i] <span style="color:#f92672">+</span> u[n][i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])) 
            u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (u[n][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">*</span>(u[n][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> u[n][<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])) 
                       <span style="color:#f92672">+</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(u[n][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u[n][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> u[n][<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
            u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]
    
    <span style="color:#66d9ef">return</span> x, u, u_analytical

pos, vel, vel_analytical <span style="color:#f92672">=</span> burgersEquation(<span style="color:#ae81ff">101</span>,<span style="color:#ae81ff">0.5</span>)

<span style="color:#75715e"># Plotting</span>
pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>,figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">4</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#ae81ff">0</span>], marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Initial&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, lw<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Computational Result&#39;</span>)
pyplot<span style="color:#f92672">.</span>plot(pos, vel_analytical, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Analytical Result&#39;</span>)
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Position (m)&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Velocity (m/s)&#39;</span>)
pyplot<span style="color:#f92672">.</span>xlim([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>numpy<span style="color:#f92672">.</span>pi])
pyplot<span style="color:#f92672">.</span>ylim([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>])
pyplot<span style="color:#f92672">.</span>legend()
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/1DBurgerStud.svg" alt="svg"></p>
<h3 id="aside-kardarparisizhang-equation"><strong>Aside: Kardar–Parisi–Zhang equation</strong></h3>
<h4 id="student-5">Student</h4>
<p>The KPZ equation is a generalisation of Burgers&rsquo; equation to multiple dimensions. Write Burgers&rsquo; equation in the form:</p>
<p>$$ \frac{\partial u}{\partial t} + \frac{1}{2}\frac{\partial u^2}{\partial x} = \nu\frac{\partial^2 u}{\partial x^2} $$</p>
<p>Let $ u = \psi_x $, then Burgers&rsquo; equation becomes:</p>
<p>$$ \psi_{tx} + \psi_x\psi_{xx} = \nu\psi_{xxx} $$</p>
<p>$$ \partial_x\left(\psi_t + \frac{\psi_x^2}{2} \right) = \nu\partial_x(\psi_{xx}) $$</p>
<p>Integrating with respect to $x$ gives the following equation:</p>
<p>$$ \frac{\partial \psi}{\partial t} + \frac{1}{2}\left(\frac{\partial \psi}{\partial x}\right)^2 = \nu\frac{\partial^2 \psi}{\partial x^2} + \alpha(t) $$</p>
<p>If $\alpha(t) = 0$, we obtain the KPZ equation in one dimension, which seemingly generalises to:</p>
<p>$$ \frac{\partial \psi}{\partial t} + \frac{\lambda}{2}\left(\nabla \psi\right)^2 = \nu\nabla^2 \psi $$</p>
<p>Whatever &ldquo;$(\nabla \psi)^2$&rdquo; means. Let $\lambda = 1$ and take the one-dimensional case, then the equation has an integrating factor (thanks to Vyn from freenode&rsquo;s <code>##math</code>!), which allows it to be written in the form of the 1-D diffusion equation:</p>
<p>$$ \frac{\partial}{\partial t}\left[\exp\left(-\frac{\psi}{2\nu}\right)\right] = \nu\frac{\partial^2}{\partial x^2}\left[\exp\left(-\frac{\psi}{2\nu}\right)\right] $$</p>
<p>TODO: Add solution.</p>
<h3 id="step-5-2d-linear-convection"><strong>Step 5: 2D Linear Convection</strong></h3>
<h4 id="professor-5">Professor</h4>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial u}{\partial t} + c\left(\frac{\partial u}{\partial x} + \frac{\partial u}{\partial y} \right) = 0 $$</p>
<p>Discretised:</p>
<p>$$ \frac{u^{n+1}_{i,j} - u^n_{i,j}}{\Delta t} + c\left(\frac{u^n_{i,j} - u^n_{i-1,j}}{\Delta x} + \frac{u^n_{i,j} - u^n_{i,j-1}}{\Delta y}\right) = 0 $$</p>
<p>Initial condition:</p>
<p>$$ u(x,0)= \begin{cases} 2, &amp; x \in [0.5,1] \times [0.5,1] \\ 1, &amp; \mathrm{everywhere;else} \end{cases} $$</p>
<p><strong>Student&rsquo;s modification:</strong> This has been modified into a function to take a variable argument, which decides whether to use a &ldquo;fast&rdquo; (which uses array operations with NumPy) or a &ldquo;slow&rdquo; (which uses <code>for</code> loops) implementation. Fast is implemented by default, and the slow variant can be implemented by feeding <code>False</code> into the function. <code>timeit</code> has been imported to clock the processing speeds of each variant.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linearconv2D</span>(fast<span style="color:#f92672">=</span>True):
    nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">81</span>
    ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">81</span>
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(nx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(ny <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>
    nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
    dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>dx

    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, nx)
    y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, ny)
    
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny,nx))
    un <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny,nx))
    u[int(<span style="color:#ae81ff">0.5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1.0</span><span style="color:#f92672">/</span>dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1.0</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> 
    
    fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">7</span>) dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
    X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x,y)
    surf <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, u[:], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)
    pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
    
    <span style="color:#66d9ef">if</span> fast:
        tick <span style="color:#f92672">=</span> timeit<span style="color:#f92672">.</span>default_timer()
        <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
            un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
            u[<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">=</span> u[<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">*</span>((u[<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> u[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:])<span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> (u[<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:,:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>dy)
            u[<span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
            u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
            u[:,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
            u[:,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        tock <span style="color:#f92672">=</span> timeit<span style="color:#f92672">.</span>default_timer()
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Array operations took </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> seconds&#39;</span> <span style="color:#f92672">%</span>(tock <span style="color:#f92672">-</span> tick))
    <span style="color:#66d9ef">else</span>:
        tick <span style="color:#f92672">=</span> timeit<span style="color:#f92672">.</span>default_timer()
        <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
            un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
            row, col <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>shape
            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, row):
                <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, col):
                    u[j,i] <span style="color:#f92672">=</span> un[j,i] <span style="color:#f92672">-</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">*</span>((un[j,i] <span style="color:#f92672">-</span> un[j,i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> (un[j,i] <span style="color:#f92672">-</span> un[j<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,i])<span style="color:#f92672">/</span>dy)
                    u[<span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
                    u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
                    u[:,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
                    u[:,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        tock <span style="color:#f92672">=</span> timeit<span style="color:#f92672">.</span>default_timer()
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;For loops took </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> seconds&#39;</span> <span style="color:#f92672">%</span>(tock <span style="color:#f92672">-</span> tick))
        
    fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
    surf2 <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, u[:], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)
    
linearconv2D()
linearconv2D(False)
</code></pre></div><pre><code>Array operations took 0.009733499959111214 seconds
For loops took 4.577128199976869 seconds
</code></pre>
<p><img src="../CFDPython_files/2DLinearConvectionInitProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DLinearConvectionProf.svg" alt="svg"></p>
<h4 id="student-6">Student</h4>
<p>This function takes the mesh size in each direction as separate inputs and also the required simulation time. It minimises the time-step based on the smaller grid distance between <code>x</code> and <code>y</code> for accuracy (at the cost of speed!).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">linearConvection2D</span>(mesh_size_x, mesh_size_y, time):
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span>(mesh_size_x <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span>(mesh_size_y <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>
    dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>min(dx,dy)
    timesteps <span style="color:#f92672">=</span> int(time<span style="color:#f92672">/</span>dt)
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>, mesh_size_x)
    y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>, mesh_size_y)
    
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((timesteps, mesh_size_x, mesh_size_y))
    u[<span style="color:#ae81ff">0</span>][int(<span style="color:#ae81ff">0.5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1.0</span><span style="color:#f92672">/</span>dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1.0</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(timesteps<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">=</span> (u[n][<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">*</span>((u[n][<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> u[n][:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:])<span style="color:#f92672">/</span>dx 
                       <span style="color:#f92672">+</span> (u[n][<span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> u[n][<span style="color:#ae81ff">1</span>:,:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>dy))
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][:,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][:,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        
    <span style="color:#66d9ef">return</span> x, y, u
    
pos_x, pos_y, vel <span style="color:#f92672">=</span> linearConvection2D(<span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">2.5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">5.0</span>)

<span style="color:#75715e"># Plotting</span>
fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
surf <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, vel[<span style="color:#ae81ff">0</span>], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)

fig2 <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig2<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
surf2 <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, vel[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/2DLinearConvectionInitStud.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DLinearConvectionStud.svg" alt="svg"></p>
<h3 id="step-6-2d-convection"><strong>Step 6: 2D Convection</strong></h3>
<h4 id="professor-6">Professor</h4>
<p>Coupled partial differential equations:</p>
<p>$$ \frac{\partial u}{\partial t} + u\frac{\partial u}{\partial x} + v\frac{\partial u}{\partial y}  = 0 $$</p>
<p>$$ \frac{\partial v}{\partial t} + u\frac{\partial v}{\partial x} + v\frac{\partial v}{\partial y}  = 0 $$</p>
<p>(Student: I think there&rsquo;s a factor $c$ missing in them.) Discretised:</p>
<p>$$ \frac{u^{n+1}_{i,j} - u^n_{i,j}}{\Delta t} + u^n_{i,j}\left(\frac{u^n_{i,j} - u^n_{i-1,j}}{\Delta x}\right) + v^n_{i,j}\left(\frac{u^n_{i,j} - u^n_{i,j-1}}{\Delta y}\right) = 0 $$</p>
<p>$$ \frac{v^{n+1}_{i,j} - v^n_{i,j}}{\Delta t} + u^n_{i,j}\left(\frac{v^n_{i,j} - v^n_{i-1,j}}{\Delta x}\right) + v^n_{i,j}\left(\frac{v^n_{i,j} - v^n_{i,j-1}}{\Delta y}\right) = 0 $$</p>
<p>Initial conditions:</p>
<p>$$ u, v = \begin{cases} 2, &amp; x,y \in [0.5,1] \times [0.5,1] \\ 1, &amp; \mathrm{everywhere;else} \end{cases}$$</p>
<p>Boundary conditions:</p>
<p>$$ u = 1, v = 1 ;\mathrm{for} \begin{cases} x = 0,2 \\ y = 0,2 \end{cases} $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">101</span>
ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">101</span>
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>
c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(ny<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>
dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>dx

x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, nx)
y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, ny)

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))
v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))
un <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))
vn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))

u[int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dy):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dx):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>  
v[int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dy):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dx):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>  

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)

ax<span style="color:#f92672">.</span>plot_surface(X, Y, u, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)

<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
    un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
    vn <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>copy()
    u[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">=</span> (un[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">*</span> c <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx
               <span style="color:#f92672">*</span> (un[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:, :<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">*</span> c <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy 
               <span style="color:#f92672">*</span> (un[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> un[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:]))
    v[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">=</span> (vn[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">*</span> c <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx
               <span style="color:#f92672">*</span> (vn[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:, :<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">*</span> c <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy 
               <span style="color:#f92672">*</span> (vn[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> vn[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:])_
    u[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    
    v[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
ax<span style="color:#f92672">.</span>plot_surface(X, Y, u, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/2DNLConvectionInitProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DNLConvectionProf.svg" alt="svg"></p>
<h4 id="student-7">Student</h4>
<p>These PDEs can be written concisely in tensor notation using Einstein&rsquo;s summation convention:</p>
<p>$$ \partial_t V^{\alpha} + cV^{\mu}\partial_{\mu}V^{\alpha} = 0 $$</p>
<p>However, there doesn&rsquo;t seem to be a neat way to write the discretisation in index notation. The computation has been made slightly more efficient by computing <code>c*dt/dx</code> and <code>c*dt/dy</code> outside the <code>for</code> loop, since those values are fixed, and hence do not need to be computed repeatedly. The same applies to the boundary conditions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convection2D</span>(mesh_size_x, mesh_size_y, time):
    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(mesh_size_x<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(mesh_size_y<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>
    dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>min(dx,dy)
    timesteps <span style="color:#f92672">=</span> int(time<span style="color:#f92672">/</span>dt)
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2.0</span>, mesh_size_x)
    y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2.0</span>, mesh_size_y)

    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((timesteps, mesh_size_x, mesh_size_y))
    v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((timesteps, mesh_size_x, mesh_size_y))
    
    <span style="color:#75715e"># Initial conditions</span>
    u[<span style="color:#ae81ff">0</span>, int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
    v[<span style="color:#ae81ff">0</span>, int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span>
    
    <span style="color:#75715e"># Boundary conditions</span>
    u[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    u[<span style="color:#ae81ff">1</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    u[<span style="color:#ae81ff">1</span>:, :,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    u[<span style="color:#ae81ff">1</span>:, :,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    v[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    v[<span style="color:#ae81ff">1</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    v[<span style="color:#ae81ff">1</span>:, :,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    v[<span style="color:#ae81ff">1</span>:, :,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    
    ctx <span style="color:#f92672">=</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx
    cty <span style="color:#f92672">=</span> c<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dy
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(timesteps<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">=</span> (u[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> ctx<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:]<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> u[n,:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:])) 
                        <span style="color:#f92672">-</span> cty<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:]<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> u[n, <span style="color:#ae81ff">1</span>:,:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])))
        v[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">1</span>:] <span style="color:#f92672">=</span> (v[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> ctx<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:]<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> v[n,:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:])) 
                        <span style="color:#f92672">-</span> cty<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:]<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">1</span>:,<span style="color:#ae81ff">1</span>:] <span style="color:#f92672">-</span> v[n, <span style="color:#ae81ff">1</span>:,:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])))

    <span style="color:#66d9ef">return</span> x, y, u, v
    
pos_x, pos_y, vel_x, vel_y <span style="color:#f92672">=</span> convection2D(<span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">201</span>, <span style="color:#ae81ff">0.32</span>)

<span style="color:#75715e"># Plotting</span>
fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
surf <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, vel_x[<span style="color:#ae81ff">0</span>], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)

fig2 <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig2<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
surf2 <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, vel_y[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/2DNLConvectionInitStud.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DNLConvectionStud.svg" alt="svg"></p>
<h3 id="step-7-2d-diffusion"><strong>Step 7: 2D Diffusion</strong></h3>
<h4 id="professor-7">Professor</h4>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial u}{\partial t} = \nu\left(\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2}\right) $$</p>
<p>Discretised:</p>
<p>$$ \frac{u^{n+1}_i - u^n_i}{\Delta t} = \nu\left[\frac{u^n_{i+1} - 2u^n_i + u^n_{i-1}}{(\Delta x)^2} + \frac{u^n_{i+1} - 2u^n_i + u^n_{i-1}}{(\Delta y)^2}\right] $$</p>
<p>Initial conditions:</p>
<p>$$ u, v = \begin{cases} 2, &amp; x,y \in [0.5,1] \times [0.5,1] \\ 1, &amp; \mathrm{everywhere;else} \end{cases}$$</p>
<p>Boundary conditions:</p>
<p>$$ u = 1, v = 1 ;\mathrm{for} \begin{cases} x = 0,2 \\ y = 0,2 \end{cases} $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>
ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>
nu <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">05</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (nx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (ny <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
sigma <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">25</span>
dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>dx<span style="color:#f92672">*</span>dy<span style="color:#f92672">/</span>nu

x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,nx)
y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>,ny)

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny,nx))
un <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny,nx))

u[int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dy<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)
surf <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, u, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis,
        linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, antialiased<span style="color:#f92672">=</span>False)
ax<span style="color:#f92672">.</span>set_xlim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>)
ax<span style="color:#f92672">.</span>set_ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>)
ax<span style="color:#f92672">.</span>set_zlim(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2.5</span>)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">diffuse</span>(nt):
    u[int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dy):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dx):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># Student: Why is this repeated?</span>

    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
        un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
        u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] 
                       <span style="color:#f92672">+</span> nu <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) 
                       <span style="color:#f92672">+</span> nu <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (un[<span style="color:#ae81ff">2</span>:,<span style="color:#ae81ff">1</span>: <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
        u[<span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        u[:,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
        u[:,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    
    fig2 <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    ax <span style="color:#f92672">=</span> fig2<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
    surf2 <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, u[:], rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis,
        linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, antialiased<span style="color:#f92672">=</span>True)
    ax<span style="color:#f92672">.</span>set_zlim(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2.5</span>)
    ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
    ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
    
diffuse(<span style="color:#ae81ff">50</span>)
</code></pre></div><p><img src="../CFDPython_files/2DDiffusionInitProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DDiffusionProf.svg" alt="svg"></p>
<h4 id="student-8">Student</h4>
<p>The current setup is also symmetric, so computing the second component of the velocity is redundant, since $u = v$ and they&rsquo;re decoupled. I also prefer the rainbow colour map.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">diffusion2D</span>(mesh_size_x, mesh_size_y, time):
    nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.05</span>
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(mesh_size_x<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(mesh_size_y<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>
    dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>dx<span style="color:#f92672">*</span>dy<span style="color:#f92672">/</span>nu
    timesteps <span style="color:#f92672">=</span> int(time<span style="color:#f92672">/</span>dt)
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, mesh_size_x)
    y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, mesh_size_y)

    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((timesteps, mesh_size_x, mesh_size_y))
    
    <span style="color:#75715e"># Initial conditions</span>
    u[<span style="color:#ae81ff">0</span>, int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    
    <span style="color:#75715e"># Boundary conditions</span>
    u[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#ae81ff">1</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#ae81ff">1</span>:, :,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#ae81ff">1</span>:, :,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    
    lambda_x <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    lambda_y <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(timesteps<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
                           <span style="color:#f92672">+</span> lambda_x<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) 
                           <span style="color:#f92672">+</span> lambda_y<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
        
    <span style="color:#66d9ef">return</span> x, y, u
    
pos_x, pos_y, vel_x <span style="color:#f92672">=</span> diffusion2D(<span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">0.5</span>)

<span style="color:#75715e"># Plotting</span>
fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
surf <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, numpy<span style="color:#f92672">.</span>transpose(vel_x[<span style="color:#ae81ff">0</span>]), rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>rainbow, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, antialiased<span style="color:#f92672">=</span>False)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)

fig2 <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig2<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
surf2 <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, numpy<span style="color:#f92672">.</span>transpose(vel_x[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>rainbow, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, antialiased<span style="color:#f92672">=</span>True)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/2DDiffusionInitStud.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DDiffusionStud.svg" alt="svg"></p>
<h3 id="step-8-burgers-equation-in-2d"><strong>Step 8: Burgers&rsquo; Equation in 2D</strong></h3>
<h4 id="professor-8">Professor</h4>
<p>Partial differential equations:</p>
<p>$$ \frac{\partial u}{\partial t} + u\frac{\partial u}{\partial x} + v\frac{\partial u}{\partial y} = \nu\left(\frac{\partial^2 u}{\partial x^2} + \frac{\partial^2 u}{\partial y^2}\right) $$</p>
<p>$$ \frac{\partial v}{\partial t} + u\frac{\partial v}{\partial x} + v\frac{\partial v}{\partial y} = \nu\left(\frac{\partial^2 v}{\partial x^2} + \frac{\partial^2 v}{\partial y^2}\right) $$</p>
<p>Discretised:</p>
<p>\begin{split}
&amp; \frac{u_{i,j}^{n+1} - u_{i,j}^n}{\Delta t} + u_{i,j}^n \frac{u_{i,j}^n-u_{i-1,j}^n}{\Delta x} + v_{i,j}^n \frac{u_{i,j}^n - u_{i,j-1}^n}{\Delta y} = \\\<br>
&amp; \qquad \nu \left( \frac{u_{i+1,j}^n - 2u_{i,j}^n+u_{i-1,j}^n}{\Delta x^2} + \frac{u_{i,j+1}^n - 2u_{i,j}^n + u_{i,j-1}^n}{\Delta y^2} \right)
\end{split}</p>
<p>\begin{split}
&amp; \frac{v_{i,j}^{n+1} - v_{i,j}^n}{\Delta t} + u_{i,j}^n \frac{v_{i,j}^n-v_{i-1,j}^n}{\Delta x} + v_{i,j}^n \frac{v_{i,j}^n - v_{i,j-1}^n}{\Delta y} = \\\<br>
&amp; \qquad \nu \left( \frac{v_{i+1,j}^n - 2v_{i,j}^n+v_{i-1,j}^n}{\Delta x^2} + \frac{v_{i,j+1}^n - 2v_{i,j}^n + v_{i,j-1}^n}{\Delta y^2} \right)
\end{split}</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">120</span>
c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (nx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (ny <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
sigma <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">000</span><span style="color:#ae81ff">9</span>
nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.01</span>
dt <span style="color:#f92672">=</span> sigma <span style="color:#f92672">*</span> dx <span style="color:#f92672">*</span> dy <span style="color:#f92672">/</span> nu

x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, nx)
y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, ny)

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))
v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))
un <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx)) 
vn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))
comb <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))

u[int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dy):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dx):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> 
v[int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dy):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>),int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">/</span> dx):int(<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> 

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)
ax<span style="color:#f92672">.</span>plot_surface(X, Y, u[:], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
ax<span style="color:#f92672">.</span>plot_surface(X, Y, v[:], cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)

<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>): <span style="color:#75715e">##loop across number of time steps</span>
    un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
    vn <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>copy()

    u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span>
                     dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> 
                     (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span> 
                     dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> 
                     (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span> 
                     nu <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                     (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span> 
                     nu <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                     (un[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
    
    v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> 
                     dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span>
                     (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span>
                     dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> 
                    (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span> 
                     nu <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                     (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                     nu <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                     (vn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
     
    u[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    
    v[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    
fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)
ax<span style="color:#f92672">.</span>plot_surface(X, Y, u, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
ax<span style="color:#f92672">.</span>plot_surface(X, Y, v, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis, rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
</code></pre></div><p><img src="../CFDPython_files/2DBurgerInitProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DBurgerProf.svg" alt="svg"></p>
<h4 id="student-9">Student</h4>
<p>Contour plots look better than surface plots.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">burgers2D</span>(mesh_size_x, mesh_size_y, time):
    nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.01</span>
    dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(mesh_size_x<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">/</span>(mesh_size_y<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
    sigma <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0009</span>
    dt <span style="color:#f92672">=</span> sigma<span style="color:#f92672">*</span>dx<span style="color:#f92672">*</span>dy<span style="color:#f92672">/</span>nu
    timesteps <span style="color:#f92672">=</span> int(time<span style="color:#f92672">/</span>dt)
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, mesh_size_x)
    y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, mesh_size_y)

    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((timesteps, mesh_size_x, mesh_size_y))
    v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((timesteps, mesh_size_x, mesh_size_y))
    
    <span style="color:#75715e"># Initial conditions</span>
    u[<span style="color:#ae81ff">0</span>, int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>), int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    v[<span style="color:#ae81ff">0</span>, int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dx):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>), int(<span style="color:#f92672">.</span><span style="color:#ae81ff">5</span><span style="color:#f92672">/</span>dy):int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>dy <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    
    <span style="color:#75715e"># Boundary conditions</span>
    u[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#ae81ff">1</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#ae81ff">1</span>:, :,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    u[<span style="color:#ae81ff">1</span>:, :,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[<span style="color:#ae81ff">1</span>:, <span style="color:#ae81ff">0</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[<span style="color:#ae81ff">1</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,:] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[<span style="color:#ae81ff">1</span>:, :,<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    v[<span style="color:#ae81ff">1</span>:, :,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>

    r_x <span style="color:#f92672">=</span> dt<span style="color:#f92672">/</span>dx
    r_y <span style="color:#f92672">=</span> dt<span style="color:#f92672">/</span>dy
    lambda_x <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    lambda_y <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(timesteps<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        u[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
                            <span style="color:#f92672">-</span> r_x<span style="color:#f92672">*</span>u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) 
                            <span style="color:#f92672">-</span> r_y<span style="color:#f92672">*</span>v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                            <span style="color:#f92672">+</span> lambda_x<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) 
                            <span style="color:#f92672">+</span> lambda_y<span style="color:#f92672">*</span>(u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
        
        v[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
                            <span style="color:#f92672">-</span> r_x<span style="color:#f92672">*</span>u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                            <span style="color:#f92672">-</span> r_y<span style="color:#f92672">*</span>v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) 
                            <span style="color:#f92672">+</span> lambda_x<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) 
                            <span style="color:#f92672">+</span> lambda_y<span style="color:#f92672">*</span>(v[n, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
        
    <span style="color:#66d9ef">return</span> x, y, u, v
    
pos_x, pos_y, vel_x, vel_y <span style="color:#f92672">=</span> burgers2D(<span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">0.2</span>)

X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)

<span style="color:#75715e"># Plotting</span>
fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">1</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>contour(X, Y, numpy<span style="color:#f92672">.</span>transpose(vel_x[<span style="color:#ae81ff">0</span>]), <span style="color:#ae81ff">100</span>)
pyplot<span style="color:#f92672">.</span>pcolormesh(X, Y, numpy<span style="color:#f92672">.</span>transpose(vel_x[<span style="color:#ae81ff">0</span>]), cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>jet)
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
cbar <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>colorbar()
cbar<span style="color:#f92672">.</span>set_label(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$u\_{\mathrm{init}}$&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)

fig2 <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(<span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>contour(X, Y, numpy<span style="color:#f92672">.</span>transpose(vel_x[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), <span style="color:#ae81ff">100</span>)
pyplot<span style="color:#f92672">.</span>pcolormesh(X, Y, numpy<span style="color:#f92672">.</span>transpose(vel_x[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>jet)
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
cbar <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>colorbar()
cbar<span style="color:#f92672">.</span>set_label(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;$u\_{\mathrm{final}}$&#39;</span>)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/2DBurgerInitStud.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DBurgerStud.svg" alt="svg"></p>
<h3 id="step-9-2d-laplace-equation"><strong>Step 9: 2D Laplace Equation</strong></h3>
<h4 id="professor-9">Professor</h4>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial^2 p}{\partial x^2} + \frac{\partial^2 p}{\partial y^2} = 0 $$</p>
<p>Discretised:</p>
<p>$$ \frac{p^n_{i+1,j} - 2p^n_{i,j} + p^n_{i-1,j}}{\Delta x^2} + \frac{p^n_{i,j+1} - 2p^n_{i,j} + p^n_{i,j-1}}{\Delta y^2} = 0 $$</p>
<p>Gist: There is no time-dependence, so the $n$ represents the iteration number from some initial guess.</p>
<p>The implementation is left as an exercise for the student, with boundary conditions:</p>
<p>$$ p(0,y) = 0, ; p(2,y) = y, ; \frac{\partial p}{\partial y}\bigg|_{(x,0),,(x,1)} = 0$$</p>
<p>Analytical solution for this case:</p>
<p>$$ p(x,y) = \frac{x}{4} - 4\sum_{n=0}^{\infty} \frac{\sin{[(2n+1)\pi x]}\cos{[(2n+1)\pi y]}}{[(2n+1)\pi]^2\sinh{[(2n+1)\pi x]}} $$</p>
<h4 id="student-10">Student</h4>
<p>The point of this step is to use functions, which is what&rsquo;s been done so far. The plotter could be written as a function. The solver functions can also be generalised to accept the user&rsquo;s desired domain. Apparently NumPy&rsquo;s <code>meshgrid</code> transposes the domain grid.</p>
<p>The derivative boundary condition needs to be discretised appropriately to avoid unknowns:</p>
<p>$$ p_{i,0} = p_{i,1}, ; p_{i,n-1} = p_{i,n}$$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plotContour2D</span>(pos_x, pos_y, var, index, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>, title<span style="color:#f92672">=</span>None, zlabel<span style="color:#f92672">=</span>None):
    fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>figsize, dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
    pyplot<span style="color:#f92672">.</span>contour(X, Y, numpy<span style="color:#f92672">.</span>transpose(var[index]), <span style="color:#ae81ff">100</span>)
    pyplot<span style="color:#f92672">.</span>pcolormesh(X, Y, numpy<span style="color:#f92672">.</span>transpose(var[index]), cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>jet)
    pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
    pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
    cbar <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>colorbar()
    <span style="color:#66d9ef">if</span> title <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        pyplot<span style="color:#f92672">.</span>title(title)
    <span style="color:#66d9ef">if</span> zlabel <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        cbar<span style="color:#f92672">.</span>set_label(zlabel)
    pyplot<span style="color:#f92672">.</span>tight_layout()
    <span style="color:#66d9ef">return</span> fig

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plotSurface2D</span>(pos_x, pos_y, var, index, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>, title<span style="color:#f92672">=</span>None, zlabel<span style="color:#f92672">=</span>None):
    fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>figsize, dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
    X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(pos_x, pos_y)
    surf <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, numpy<span style="color:#f92672">.</span>transpose(var[index]), rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>rainbow, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, antialiased<span style="color:#f92672">=</span>False)
    ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
    ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
    cbar <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>colorbar(surf, shrink<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>)
    <span style="color:#66d9ef">if</span> title <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        pyplot<span style="color:#f92672">.</span>title(title)
    <span style="color:#66d9ef">if</span> zlabel <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        cbar<span style="color:#f92672">.</span>set_label(zlabel)
    pyplot<span style="color:#f92672">.</span>tight_layout()
    <span style="color:#66d9ef">return</span> fig

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">laplace2D</span>(mesh_size_x, mesh_size_y, xrange, yrange, residual, max_iter <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>):
    dx <span style="color:#f92672">=</span> abs(xrange[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> xrange[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>(mesh_size_x <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    dy <span style="color:#f92672">=</span> abs(yrange[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> yrange[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>(mesh_size_y <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(xrange[<span style="color:#ae81ff">0</span>], xrange[<span style="color:#ae81ff">1</span>], mesh_size_x)
    y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(yrange[<span style="color:#ae81ff">0</span>], yrange[<span style="color:#ae81ff">1</span>], mesh_size_y)

    p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((max_iter, mesh_size_x, mesh_size_y))
    
    <span style="color:#75715e"># Initial guess</span>
    p[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(yrange[<span style="color:#ae81ff">0</span>], yrange[<span style="color:#ae81ff">1</span>], mesh_size_y)
    p[<span style="color:#ae81ff">0</span>, :, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> p[<span style="color:#ae81ff">0</span>, :, <span style="color:#ae81ff">1</span>]
    p[<span style="color:#ae81ff">0</span>, :, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> p[<span style="color:#ae81ff">0</span>, :, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
    
    res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">while</span> (n <span style="color:#f92672">&lt;</span> max_iter <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>):
        p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> ((dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> p[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) 
                            <span style="color:#f92672">+</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>(dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)))

        p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(yrange[<span style="color:#ae81ff">0</span>], yrange[<span style="color:#ae81ff">1</span>], mesh_size_y)
        p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, :, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> p[n, :, <span style="color:#ae81ff">1</span>]
        p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, :, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> p[n, :, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
        
        residual <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>sum(numpy<span style="color:#f92672">.</span>abs(p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span> numpy<span style="color:#f92672">.</span>abs(p[n]))<span style="color:#f92672">/</span>numpy<span style="color:#f92672">.</span>sum(numpy<span style="color:#f92672">.</span>abs(p[n]))
        n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
    <span style="color:#66d9ef">return</span> x, y, p
                    
pos_x, pos_y, pressure <span style="color:#f92672">=</span> laplace2D(<span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">51</span>, (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>), (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">1e-3</span>, <span style="color:#ae81ff">2000</span>)
                    
contour <span style="color:#f92672">=</span> plotContour2D(pos_x, pos_y, pressure, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Student&#39;</span>, zlabel<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$p$&#39;</span>)
surf <span style="color:#f92672">=</span> plotSurface2D(pos_x, pos_y, pressure, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, zlabel<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$p$&#39;</span>)
</code></pre></div><p><img src="../CFDPython_files/2DLaplaceContStud.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DLaplaceSurfStud.svg" alt="svg"></p>
<h3 id="step-10-2d-poisson-equation"><strong>Step 10: 2D Poisson Equation</strong></h3>
<h4 id="professor-10">Professor</h4>
<p>Partial differential equation:</p>
<p>$$ \frac{\partial^2 p}{\partial x^2} + \frac{\partial^2 p}{\partial y^2} = b(x,y) $$</p>
<p>Discretised:</p>
<p>$$ \frac{p^n_{i+1,j} - 2p^n_{i,j} + p^n_{i-1,j}}{\Delta x^2} + \frac{p^n_{i,j+1} - 2p^n_{i,j} + p^n_{i,j-1}}{\Delta y^2} = b^n_{i,j} $$</p>
<p>Gist: There is no time-dependence, so the $n$ represents the iteration number from some initial guess.</p>
<p>The initial guess is $p = 0$ everywhere with the boundary conditions:</p>
<p>$$ p(x,0) = p(x,1) = p(0,y) = p(2,y) = 0 $$</p>
<p>Source terms:</p>
<p>$$ b(x,y) = 0, ; b(x_{max}/4, y_{max}/4) = 100, ; b(3x_{max}/4, 3y_{max}/4) = -100 $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Parameters</span>
nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
nt  <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
xmin <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
xmax <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
ymin <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
ymax <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>

dx <span style="color:#f92672">=</span> (xmax <span style="color:#f92672">-</span> xmin) <span style="color:#f92672">/</span> (nx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
dy <span style="color:#f92672">=</span> (ymax <span style="color:#f92672">-</span> ymin) <span style="color:#f92672">/</span> (ny <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Initialization</span>
p  <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
pd <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
b  <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
x  <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(xmin, xmax, nx)
y  <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(xmin, xmax, ny)

<span style="color:#75715e"># Source</span>
b[int(ny <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>), int(nx <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>)]  <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
b[int(<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> ny <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>), int(<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> nx <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>)] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>

<span style="color:#66d9ef">for</span> it <span style="color:#f92672">in</span> range(nt):

    pd <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()

    p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (((pd[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> pd[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span>
                    (pd[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pd[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">*</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span>
                    b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">/</span> 
                    (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)))

    p[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[ny<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[:, nx<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot2D</span>(x, y, p):
    fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">7</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
    ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>gca(projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;3d&#39;</span>)
    X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)
    surf <span style="color:#f92672">=</span> ax<span style="color:#f92672">.</span>plot_surface(X, Y, p[:], rstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cstride<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis,
            linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, antialiased<span style="color:#f92672">=</span>False)
    ax<span style="color:#f92672">.</span>view_init(<span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">225</span>)
    ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
    ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
    
    <span style="color:#75715e"># Student: Why not return the figure?</span>
    <span style="color:#66d9ef">return</span> fig
    
surf <span style="color:#f92672">=</span> plot2D(x, y, p)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)
</code></pre></div><p><img src="../CFDPython_files/2DPoissonProf.svg" alt="svg"></p>
<h4 id="student-11">Student</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">poisson2D</span>(mesh_size_x, mesh_size_y, xrange, yrange, residual, max_iter <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>):
    dx <span style="color:#f92672">=</span> abs(xrange[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> xrange[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>(mesh_size_x <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    dy <span style="color:#f92672">=</span> abs(yrange[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> yrange[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>(mesh_size_y <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    
    x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(xrange[<span style="color:#ae81ff">0</span>], xrange[<span style="color:#ae81ff">1</span>], mesh_size_x)
    y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(yrange[<span style="color:#ae81ff">0</span>], yrange[<span style="color:#ae81ff">1</span>], mesh_size_y)

    p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((max_iter, mesh_size_x, mesh_size_y))
    b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
    
    <span style="color:#75715e"># Initial guess</span>
    p[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[:, <span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[:, :, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    p[:, :, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    
    <span style="color:#75715e"># Source term</span>
    b[int(mesh_size_x<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>), int(mesh_size_y<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
    b[int(<span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>mesh_size_x<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>), int(<span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>mesh_size_y<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>)] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>
    
    res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">while</span> n <span style="color:#f92672">&lt;</span> max_iter <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
        p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> ((dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> p[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                            <span style="color:#f92672">+</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) 
                            <span style="color:#f92672">-</span> b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>(dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)))

        residual <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>sum(numpy<span style="color:#f92672">.</span>abs(p[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span> numpy<span style="color:#f92672">.</span>abs(p[n]))<span style="color:#f92672">/</span>numpy<span style="color:#f92672">.</span>sum(numpy<span style="color:#f92672">.</span>abs(p[n]))
        n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
    <span style="color:#66d9ef">return</span> x, y, p
                    
pos_x, pos_y, pressure <span style="color:#f92672">=</span> poisson2D(<span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">51</span>, (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>), (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">1e-3</span>, <span style="color:#ae81ff">2000</span>)
                    
contour <span style="color:#f92672">=</span> plotContour2D(pos_x, pos_y, pressure, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Student&#39;</span>, zlabel<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$p$&#39;</span>)
surf <span style="color:#f92672">=</span> plotSurface2D(pos_x, pos_y, pressure, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, zlabel<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$p$&#39;</span>)
</code></pre></div><p><img src="../CFDPython_files/2DPoissonContStud.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DPoissonSurfStud.svg" alt="svg"></p>
<h3 id="step-11-cavity-flow-with-navier-stokes"><strong>Step 11: Cavity Flow with Navier-Stokes</strong></h3>
<h4 id="professor-11">Professor</h4>
<p>Partial differential equations:</p>
<p>$$ \frac{\partial u}{\partial t}+u\frac{\partial u}{\partial x}+v\frac{\partial u}{\partial y} = -\frac{1}{\rho}\frac{\partial p}{\partial x}+\nu \left(\frac{\partial^2 u}{\partial x^2}+\frac{\partial^2 u}{\partial y^2} \right) $$</p>
<p>$$ \frac{\partial v}{\partial t}+u\frac{\partial v}{\partial x}+v\frac{\partial v}{\partial y} = -\frac{1}{\rho}\frac{\partial p}{\partial y}+\nu\left(\frac{\partial^2 v}{\partial x^2}+\frac{\partial^2 v}{\partial y^2}\right) $$</p>
<p>$$ \frac{\partial^2 p}{\partial x^2}+\frac{\partial^2 p}{\partial y^2} = -\rho\left(\frac{\partial u}{\partial x}\frac{\partial u}{\partial x}+2\frac{\partial u}{\partial y}\frac{\partial v}{\partial x}+\frac{\partial v}{\partial y}\frac{\partial v}{\partial y} \right) $$</p>
<p>Discretised:</p>
<p>\begin{split}
&amp; \frac{u_{i,j}^{n+1}-u_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i,j-1}^{n}}{\Delta y} = \\\<br>
&amp; \qquad -\frac{1}{\rho}\frac{p_{i+1,j}^{n}-p_{i-1,j}^{n}}{2\Delta x}+\nu\left(\frac{u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n}}{\Delta x^2}+\frac{u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n}}{\Delta y^2}\right)
\end{split}</p>
<p>\begin{split}
&amp; \frac{v_{i,j}^{n+1}-v_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i,j-1}^{n}}{\Delta y} = \\\<br>
&amp; \qquad -\frac{1}{\rho}\frac{p_{i,j+1}^{n}-p_{i,j-1}^{n}}{2\Delta y}
+\nu\left(\frac{v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n}}{\Delta x^2}+\frac{v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n}}{\Delta y^2}\right)
\end{split}</p>
<p>\begin{split}
&amp; \frac{p_{i+1,j}^{n}-2p_{i,j}^{n}+p_{i-1,j}^{n}}{\Delta x^2} + \frac{p_{i,j+1}^{n}-2p_{i,j}^{n}+p_{i,j-1}^{n}}{\Delta y^2} = \\\<br>
&amp; \qquad \rho\left[\frac{1}{\Delta t}\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}+\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right) \right] \\\<br>
&amp; \qquad -\rho\left[\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\right)^2 + 2\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y}\frac{v_{i+1,j}-v_{i-1,j}}{2\Delta x} + \left(\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right)^2\right]
\end{split}</p>
<p>The initial condition is zero everywhere for all variables. Boundary conditions:</p>
<p>$$ u(x_{bound},y_{bound}) = 0, ; u(x,2) = 2,; \frac{\partial p}{\partial y}\bigg|_{y = 0} = 0,; p(x,2) = 0,; \frac{\partial p}{\partial x}\bigg|_{x = 0, 2} = 0 $$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
nit <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (nx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (ny <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, nx)
y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, ny)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)

rho <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
nu <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">1</span>
dt <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">001</span>

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx)) 
b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))

<span style="color:#75715e"># To avoid typos</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build_up_b</span>(b, rho, dt, u, v, dx, dy):
    
    b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (rho <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dt <span style="color:#f92672">*</span> 
                    ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> 
                     (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx) <span style="color:#f92672">+</span> (v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy)) <span style="color:#f92672">-</span>
                    ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span>
                      <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> ((u[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span>
                           (v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx))<span style="color:#f92672">-</span>
                          ((v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))

    <span style="color:#66d9ef">return</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pressure_poisson</span>(p, dx, dy, b):
    pn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>empty_like(p)
    pn <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()
    
    <span style="color:#66d9ef">for</span> q <span style="color:#f92672">in</span> range(nit):
        pn <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()
        p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (((pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> 
                          (pn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">*</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">/</span>
                          (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">-</span>
                          dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">*</span> 
                          b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

        p[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> p[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#75715e"># dp/dx = 0 at x = 2</span>
        p[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> p[<span style="color:#ae81ff">1</span>, :]   <span style="color:#75715e"># dp/dy = 0 at y = 0</span>
        p[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> p[:, <span style="color:#ae81ff">1</span>]   <span style="color:#75715e"># dp/dx = 0 at x = 0</span>
        p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>        <span style="color:#75715e"># p = 0 at y = 2</span>
        
    <span style="color:#66d9ef">return</span> p

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cavity_flow</span>(nt, u, v, dt, dx, dy, p, rho, nu):
    un <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>empty_like(u)
    vn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>empty_like(v)
    b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
    
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(nt):
        un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
        vn <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>copy()
        
        b <span style="color:#f92672">=</span> build_up_b(b, rho, dt, u, v, dx, dy)
        p <span style="color:#f92672">=</span> pressure_poisson(p, dx, dy, b)
        
        u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>
                         un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span>
                        (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span>
                         vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span>
                        (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                         dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dx) <span style="color:#f92672">*</span> (p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                         nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                        (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                         dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                        (un[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])))

        v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span>
                        un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span>
                       (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span>
                        vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span>
                       (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                        dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span> (p[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span>
                        nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                       (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                        dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                       (vn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])))

        u[<span style="color:#ae81ff">0</span>, :]  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        u[:, <span style="color:#ae81ff">0</span>]  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        u[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>    <span style="color:#75715e"># set velocity on cavity lid equal to 1</span>
        v[<span style="color:#ae81ff">0</span>, :]  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        v[:, <span style="color:#ae81ff">0</span>]  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        v[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        
    <span style="color:#66d9ef">return</span> u, v, p

u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
u, v, p <span style="color:#f92672">=</span> cavity_flow(nt, u, v, dt, dx, dy, p, rho, nu)

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
<span style="color:#75715e"># plotting the pressure field as a contour</span>
pyplot<span style="color:#f92672">.</span>contourf(X, Y, p, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)  
pyplot<span style="color:#f92672">.</span>colorbar()
<span style="color:#75715e"># plotting the pressure field outlines</span>
pyplot<span style="color:#f92672">.</span>contour(X, Y, p, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)  
<span style="color:#75715e"># plotting velocity field</span>
pyplot<span style="color:#f92672">.</span>quiver(X[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>], Y[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>], u[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>], v[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>]) 
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;X&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Y&#39;</span>);
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>contourf(X, Y, p, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)
pyplot<span style="color:#f92672">.</span>colorbar()
pyplot<span style="color:#f92672">.</span>contour(X, Y, p, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>viridis)
pyplot<span style="color:#f92672">.</span>streamplot(X, Y, u, v)
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;X&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Y&#39;</span>);
</code></pre></div><p><img src="../CFDPython_files/2DCavityProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DCavityStreamProf.svg" alt="svg"></p>
<h4 id="student-12">Student</h4>
<p>No noticeable improvements to be made, except the usual boundary condition computation out of the loop and recording time-evolution.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pressureSource</span>(b, rho, u, v, dx, dy, dt):
    
    b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (rho<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dt)<span style="color:#f92672">*</span>((u[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>dx 
                    <span style="color:#f92672">+</span> (v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>dy)
                    <span style="color:#f92672">-</span> ((u[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                    <span style="color:#f92672">-</span> (u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>(v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx<span style="color:#f92672">*</span>dy) 
                    <span style="color:#f92672">-</span> ((v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
    
    <span style="color:#66d9ef">return</span> b
                  
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pressurePoisson</span>(p, b, dx, dy, sub_iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>):
    pn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>empty_like(p)
    pn <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(sub_iterations):
        pn <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()
        p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> ((pn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                        <span style="color:#f92672">+</span> (pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                        <span style="color:#f92672">-</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>(dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) 
        
    p[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.</span>
    p[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> p[:, <span style="color:#ae81ff">1</span>]
    p[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> p[<span style="color:#ae81ff">1</span>, :]
    p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> p[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, :]
    
    <span style="color:#66d9ef">return</span> p
                
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cavityFlow2D</span>(bounds, mesh_size_x, mesh_size_y, timesteps, dt, u_init, v_init, p_init, rho, nu, sub_iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>):
    dx <span style="color:#f92672">=</span> abs(bounds[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> bounds[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>mesh_size_x 
    dy <span style="color:#f92672">=</span> abs(bounds[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> bounds[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>mesh_size_y
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((timesteps, mesh_size_x, mesh_size_y))
    v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((timesteps, mesh_size_x, mesh_size_y))
    p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((timesteps, mesh_size_x, mesh_size_y))
    b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
    
    u[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> u_init
    v[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> v_init
    p[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> p_init
    
    u[<span style="color:#ae81ff">1</span>:, :, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.</span>
    
    l_x <span style="color:#f92672">=</span> dt<span style="color:#f92672">/</span>dx
    l_y <span style="color:#f92672">=</span> dt<span style="color:#f92672">/</span>dy
    n_x <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    n_y <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,timesteps):
        
        b <span style="color:#f92672">=</span> pressureSource(b, rho, u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], dx, dy, dt)
        p[n] <span style="color:#f92672">=</span> pressurePoisson(p[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], b, dx, dy, sub_iterations)
        
        u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
                          <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                          <span style="color:#f92672">-</span> l_x<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">+</span> n_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
        v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
                          <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">-</span> l_x<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                          <span style="color:#f92672">+</span> n_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
        
    <span style="color:#66d9ef">return</span> u, v, p

mesh_size_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
mesh_size_y <span style="color:#f92672">=</span> <span style="color:#ae81ff">120</span>
rho <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
nu <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">1</span>
timesteps <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
dt <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">001</span>
sub_iterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
x_domain <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">4</span>)
y_domain <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>)
x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(x_domain[<span style="color:#ae81ff">0</span>], x_domain[<span style="color:#ae81ff">1</span>], mesh_size_x)
y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(y_domain[<span style="color:#ae81ff">0</span>], y_domain[<span style="color:#ae81ff">1</span>], mesh_size_y)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)
u_i <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
v_i <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
p_i <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
u, v, p <span style="color:#f92672">=</span> cavityFlow2D([x_domain, y_domain], mesh_size_x, mesh_size_y, timesteps, dt, u_i, v_i, p_i, rho, nu, sub_iterations)

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>contourf(X, Y, numpy<span style="color:#f92672">.</span>transpose(p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>rainbow)  
pyplot<span style="color:#f92672">.</span>colorbar(label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$p$&#39;</span>)
pyplot<span style="color:#f92672">.</span>contour(X, Y, numpy<span style="color:#f92672">.</span>transpose(p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>rainbow)  
pyplot<span style="color:#f92672">.</span>quiver(X[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>], Y[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>], numpy<span style="color:#f92672">.</span>transpose(u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, ::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>]), numpy<span style="color:#f92672">.</span>transpose(v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, ::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>])) 
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">7</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>contourf(X, Y, numpy<span style="color:#f92672">.</span>transpose(p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>rainbow)
pyplot<span style="color:#f92672">.</span>colorbar(label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$p$&#39;</span>)
pyplot<span style="color:#f92672">.</span>contour(X, Y, numpy<span style="color:#f92672">.</span>transpose(p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), cmap<span style="color:#f92672">=</span>cm<span style="color:#f92672">.</span>rainbow)
pyplot<span style="color:#f92672">.</span>streamplot(X, Y, numpy<span style="color:#f92672">.</span>transpose(u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]), numpy<span style="color:#f92672">.</span>transpose(v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
pyplot<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;$x$&#39;</span>)
pyplot<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;$y$&#39;</span>)
pyplot<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="../CFDPython_files/2DCavityStud.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DCavityStreamStud.svg" alt="svg"></p>
<h3 id="step-12-channel-flow-with-navier-stokes">Step 12: Channel Flow with Navier-Stokes</h3>
<h4 id="professor-12">Professor</h4>
<p>Partial differential equations:</p>
<p>$$ \frac{\partial u}{\partial t}+u\frac{\partial u}{\partial x}+v\frac{\partial u}{\partial y}=-\frac{1}{\rho}\frac{\partial p}{\partial x}+\nu\left(\frac{\partial^2 u}{\partial x^2}+\frac{\partial^2 u}{\partial y^2}\right)+F $$</p>
<p>$$ \frac{\partial v}{\partial t}+u\frac{\partial v}{\partial x}+v\frac{\partial v}{\partial y}=-\frac{1}{\rho}\frac{\partial p}{\partial y}+\nu\left(\frac{\partial^2 v}{\partial x^2}+\frac{\partial^2 v}{\partial y^2}\right) $$</p>
<p>$$ \frac{\partial^2 p}{\partial x^2}+\frac{\partial^2 p}{\partial y^2}=-\rho\left(\frac{\partial u}{\partial x}\frac{\partial u}{\partial x}+2\frac{\partial u}{\partial y}\frac{\partial v}{\partial x}+\frac{\partial v}{\partial y}\frac{\partial v}{\partial y}\right) $$</p>
<p>Discretised:</p>
<p>\begin{split}
&amp; \frac{u_{i,j}^{n+1}-u_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{u_{i,j}^{n}-u_{i,j-1}^{n}}{\Delta y} = \\\<br>
&amp; \qquad -\frac{1}{\rho}\frac{p_{i+1,j}^{n}-p_{i-1,j}^{n}}{2\Delta x} \\\<br>
&amp; \qquad +\nu\left(\frac{u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n}}{\Delta x^2}+\frac{u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n}}{\Delta y^2}\right)+F_{i,j}
\end{split}</p>
<p>\begin{split}
&amp; \frac{v_{i,j}^{n+1}-v_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i-1,j}^{n}}{\Delta x}+v_{i,j}^{n}\frac{v_{i,j}^{n}-v_{i,j-1}^{n}}{\Delta y} = \\\<br>
&amp; \qquad -\frac{1}{\rho}\frac{p_{i,j+1}^{n}-p_{i,j-1}^{n}}{2\Delta y} \\\<br>
&amp; \qquad +\nu\left(\frac{v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n}}{\Delta x^2}+\frac{v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n}}{\Delta y^2}\right)
\end{split}</p>
<p>\begin{split}
&amp; \frac{p_{i+1,j}^{n}-2p_{i,j}^{n}+p_{i-1,j}^{n}}{\Delta x^2} + \frac{p_{i,j+1}^{n}-2p_{i,j}^{n}+p_{i,j-1}^{n}}{\Delta y^2} = \\\<br>
&amp; \qquad \rho\left[\frac{1}{\Delta t}\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}+\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right) \right] \\\<br>
&amp; \qquad -\rho\left[\left(\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x}\right)^2 + 2\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y}\frac{v_{i+1,j}-v_{i-1,j}}{2\Delta x} + \left(\frac{v_{i,j+1}-v_{i,j-1}}{2\Delta y}\right)^2\right]
\end{split}</p>
<p>The initial condition is zero everywhere for all variables. Boundary conditions:</p>
<p>$u,, v$ and $p$ are periodic on $x = 0,2$</p>
<p>$$ u(x,0) = u(x,2) = v(x,0) = v(x,2) = 0, ; \frac{\partial p}{\partial y}\bigg|_{y=0,2} = 0, ; F(x,y) = 1,, \forall (x,y) \in [0,2]\times[0,2]$$</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">build_up_b</span>(rho, dt, dx, dy, u, v):
    b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros_like(u)
    b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (rho <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dt <span style="color:#f92672">*</span> ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx) <span style="color:#f92672">+</span>
                                      (v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy)) <span style="color:#f92672">-</span>
                            ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span>
                            <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> ((u[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span>
                                 (v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx))<span style="color:#f92672">-</span>
                            ((v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
    
    <span style="color:#75715e"># Periodic BC Pressure @ x = 2</span>
    b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (rho <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dt <span style="color:#f92672">*</span> ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx) <span style="color:#f92672">+</span>
                                    (v[<span style="color:#ae81ff">2</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy)) <span style="color:#f92672">-</span>
                          ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span>
                          <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> ((u[<span style="color:#ae81ff">2</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span>
                               (v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx)) <span style="color:#f92672">-</span>
                          ((v[<span style="color:#ae81ff">2</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))

    <span style="color:#75715e"># Periodic BC Pressure @ x = 0</span>
    b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (rho <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">/</span> dt <span style="color:#f92672">*</span> ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx) <span style="color:#f92672">+</span>
                                   (v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy)) <span style="color:#f92672">-</span>
                         ((u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span>
                         <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> ((u[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span>
                              (v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dx))<span style="color:#f92672">-</span>
                         ((v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>]) <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
    
    <span style="color:#66d9ef">return</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pressure_poisson_periodic</span>(p, dx, dy):
    pn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>empty_like(p)
    
    <span style="color:#66d9ef">for</span> q <span style="color:#f92672">in</span> range(nit):
        pn <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()
        p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (((pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span>
                          (pn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">*</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">/</span>
                         (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">-</span>
                         dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">*</span> b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

        <span style="color:#75715e"># Periodic BC Pressure @ x = 2</span>
        p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (((pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span>
                        (pn[<span style="color:#ae81ff">2</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">*</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">/</span>
                       (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">-</span>
                       dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">*</span> b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

        <span style="color:#75715e"># Periodic BC Pressure @ x = 0</span>
        p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (((pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span>
                       (pn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>]) <span style="color:#f92672">*</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">/</span>
                      (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">-</span>
                      dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> (dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) <span style="color:#f92672">*</span> b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>])
        
        <span style="color:#75715e"># Wall boundary conditions, pressure</span>
        p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span>p[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, :]  <span style="color:#75715e"># dp/dy = 0 at y = 2</span>
        p[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> p[<span style="color:#ae81ff">1</span>, :]  <span style="color:#75715e"># dp/dy = 0 at y = 0</span>
    
    <span style="color:#66d9ef">return</span> p

<span style="color:#75715e">##variable declarations</span>
nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
nt <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
nit <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span> 
c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (nx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">/</span> (ny <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, nx)
y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, ny)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)

<span style="color:#75715e">##physical variables</span>
rho <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
nu <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">1</span>
F <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
dt <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">01</span>

<span style="color:#75715e">#initial conditions</span>
u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
un <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))

v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))
vn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))

p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))
pn <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>ones((ny, nx))

b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((ny, nx))

udiff <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
stepcount <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

<span style="color:#66d9ef">while</span> udiff <span style="color:#f92672">&gt;</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">001</span>:
    un <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>copy()
    vn <span style="color:#f92672">=</span> v<span style="color:#f92672">.</span>copy()

    b <span style="color:#f92672">=</span> build_up_b(rho, dt, dx, dy, u, v)
    p <span style="color:#f92672">=</span> pressure_poisson_periodic(p, dx, dy)

    u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span>
                     un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span> 
                    (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span>
                     vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span> 
                    (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                     dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dx) <span style="color:#f92672">*</span> 
                    (p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                     nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                    (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                     dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                    (un[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])) <span style="color:#f92672">+</span> 
                     F <span style="color:#f92672">*</span> dt)

    v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span>
                     un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span> 
                    (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span>
                     vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span> 
                    (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                     dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span> 
                    (p[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span>
                     nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                    (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                     dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                    (vn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])))

    <span style="color:#75715e"># Periodic BC u @ x = 2     </span>
    u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span> 
                  (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span>
                   vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span> 
                  (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                   dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dx) <span style="color:#f92672">*</span>
                  (p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span> 
                   nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                  (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                   dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                  (un[<span style="color:#ae81ff">2</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])) <span style="color:#f92672">+</span> F <span style="color:#f92672">*</span> dt)

    <span style="color:#75715e"># Periodic BC u @ x = 0</span>
    u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span>
                 (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                  vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span> 
                 (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>]) <span style="color:#f92672">-</span> 
                  dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dx) <span style="color:#f92672">*</span> 
                 (p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span> 
                  nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                 (un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span>
                  dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                 (un[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> un[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>])) <span style="color:#f92672">+</span> F <span style="color:#f92672">*</span> dt)

    <span style="color:#75715e"># Periodic BC v @ x = 2</span>
    v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span>
                  (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">-</span> 
                   vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span>
                  (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                   dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span> 
                  (p[<span style="color:#ae81ff">2</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span>
                   nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                  (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span>
                   dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span>
                  (vn[<span style="color:#ae81ff">2</span>:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])))

    <span style="color:#75715e"># Periodic BC v @ x = 0</span>
    v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> un[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dx <span style="color:#f92672">*</span>
                 (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">-</span>
                  vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> dt <span style="color:#f92672">/</span> dy <span style="color:#f92672">*</span>
                 (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>]) <span style="color:#f92672">-</span>
                  dt <span style="color:#f92672">/</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> rho <span style="color:#f92672">*</span> dy) <span style="color:#f92672">*</span> 
                 (p[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> p[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>]) <span style="color:#f92672">+</span>
                  nu <span style="color:#f92672">*</span> (dt <span style="color:#f92672">/</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                 (vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span>
                  dt <span style="color:#f92672">/</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> 
                 (vn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> vn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> vn[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>])))


    <span style="color:#75715e"># Wall BC: u,v = 0 @ y = 0,2</span>
    u[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    v[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :]<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
    
    udiff <span style="color:#f92672">=</span> (numpy<span style="color:#f92672">.</span>sum(u) <span style="color:#f92672">-</span> numpy<span style="color:#f92672">.</span>sum(un)) <span style="color:#f92672">/</span> numpy<span style="color:#f92672">.</span>sum(u)
    stepcount <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">print</span>(stepcount)

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>quiver(X[::<span style="color:#ae81ff">3</span>, ::<span style="color:#ae81ff">3</span>], Y[::<span style="color:#ae81ff">3</span>, ::<span style="color:#ae81ff">3</span>], u[::<span style="color:#ae81ff">3</span>, ::<span style="color:#ae81ff">3</span>], v[::<span style="color:#ae81ff">3</span>, ::<span style="color:#ae81ff">3</span>]);
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Professor&#39;</span>)

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>quiver(X, Y, u, v);
</code></pre></div><pre><code>499
</code></pre>
<p><img src="../CFDPython_files/2DChannelInitProf.svg" alt="svg"></p>
<p><img src="../CFDPython_files/2DChannelProf.svg" alt="svg"></p>
<h4 id="student-13">Student</h4>
<p>Most of the cavity flow code can be reused here, with some changes for the boundary conditions and the source term.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pressureSource</span>(b, rho, u, v, dx, dy, dt):
    
    b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (rho<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dt)<span style="color:#f92672">*</span>((u[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>dx 
                    <span style="color:#f92672">+</span> (v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>dy)
                    <span style="color:#f92672">-</span> ((u[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                    <span style="color:#f92672">-</span> (u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>(v[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx<span style="color:#f92672">*</span>dy)
                    <span style="color:#f92672">-</span> ((v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
    
    <span style="color:#75715e"># B/C at x = 2</span>
    b[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (rho<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dt)<span style="color:#f92672">*</span>((u[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> (v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>dy) 
                 <span style="color:#f92672">-</span> ((u[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                 <span style="color:#f92672">-</span> (u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>(v[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx<span style="color:#f92672">*</span>dy) 
                 <span style="color:#f92672">-</span> ((v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
    <span style="color:#75715e"># B/C at x = 0 </span>
    b[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (rho<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dt)<span style="color:#f92672">*</span>((u[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>dx <span style="color:#f92672">+</span> (v[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>dy)
                <span style="color:#f92672">-</span> ((u[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                <span style="color:#f92672">-</span> (u[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> u[<span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>(v[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dx<span style="color:#f92672">*</span>dy)
                <span style="color:#f92672">-</span> ((v[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> v[<span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>dy))<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
    
    <span style="color:#66d9ef">return</span> b
                  
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pressurePoisson</span>(p, b, dx, dy, sub_iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>):
    pn <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(sub_iterations):
        pn <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span>copy()
        p[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> ((pn[<span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                        <span style="color:#f92672">+</span> (pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                        <span style="color:#f92672">-</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>b[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>(dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) 
        <span style="color:#75715e"># B/C at x = 2</span>
        p[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> ((pn[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                     <span style="color:#f92672">+</span> (pn[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> pn[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                     <span style="color:#f92672">-</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>b[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>(dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
        <span style="color:#75715e"># B/C at x = 0</span>
        p[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> ((pn[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> pn[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                    <span style="color:#f92672">+</span> (pn[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">+</span> pn[<span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])<span style="color:#f92672">*</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
                    <span style="color:#f92672">-</span> dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>b[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>(dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)) 
        
    p[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> p[:, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
    p[:, <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> p[:, <span style="color:#ae81ff">1</span>]
    
    <span style="color:#66d9ef">return</span> p
                
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">channelFlow2D</span>(bounds, mesh_size_x, mesh_size_y, timesteps, dt, u_init, v_init, p_init, F, rho, nu, sub_iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, tolerance<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-3</span>):
    dx <span style="color:#f92672">=</span> abs(bounds[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> bounds[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>mesh_size_x 
    dy <span style="color:#f92672">=</span> abs(bounds[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> bounds[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span>mesh_size_y
    u <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((timesteps, mesh_size_x, mesh_size_y))
    v <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((timesteps, mesh_size_x, mesh_size_y))
    p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((timesteps, mesh_size_x, mesh_size_y))
    b <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
    
    u[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> u_init
    v[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> v_init
    p[<span style="color:#ae81ff">0</span>, :, :] <span style="color:#f92672">=</span> p_init
    
    l_x <span style="color:#f92672">=</span> dt<span style="color:#f92672">/</span>dx
    l_y <span style="color:#f92672">=</span> dt<span style="color:#f92672">/</span>dy
    n_x <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dx<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    n_y <span style="color:#f92672">=</span> nu<span style="color:#f92672">*</span>dt<span style="color:#f92672">/</span>dy<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,timesteps):
<span style="color:#75715e">#     rel = 1</span>
<span style="color:#75715e">#     n = 0</span>
<span style="color:#75715e">#     while rel &gt; tolerance:</span>
    
        b <span style="color:#f92672">=</span> pressureSource(b, rho, u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], dx, dy, dt)
        p[n] <span style="color:#f92672">=</span> pressurePoisson(p[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], b, dx, dy, sub_iterations)
        
        u[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
                          <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                          <span style="color:#f92672">-</span> l_x<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[n, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">+</span> n_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span> F<span style="color:#f92672">*</span>dt)
        
        v[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
                          <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">-</span> l_x<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> p[n, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                          <span style="color:#f92672">+</span> n_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                          <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
        <span style="color:#75715e"># B/C at x = 2</span>
        u[n, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
                        <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                        <span style="color:#f92672">-</span> l_x<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[n, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                        <span style="color:#f92672">+</span> n_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                        <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span> F<span style="color:#f92672">*</span>dt)
        
        <span style="color:#75715e"># B/C at x = 0</span>
        u[n, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]))
                       <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                       <span style="color:#f92672">-</span> l_x<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> p[n, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                       <span style="color:#f92672">+</span> n_x<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                       <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]) <span style="color:#f92672">+</span> F<span style="color:#f92672">*</span>dt)
        <span style="color:#75715e"># B/C at x = 2</span>
        v[n, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
                        <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                        <span style="color:#f92672">-</span> l_y<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> p[n, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                        <span style="color:#f92672">+</span> n_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                        <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
        <span style="color:#75715e"># B/C at x = 0</span>
        v[n, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> l_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))
                        <span style="color:#f92672">-</span> u[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>l_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                        <span style="color:#f92672">-</span> l_y<span style="color:#f92672">/</span>(<span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>rho)<span style="color:#f92672">*</span>(p[n, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> p[n, <span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])
                        <span style="color:#f92672">-</span> n_x<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
                        <span style="color:#f92672">+</span> n_y<span style="color:#f92672">*</span>(v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>:] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2.0</span><span style="color:#f92672">*</span>v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> v[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, :<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]))

<span style="color:#75715e">#         rel = (numpy.sum(u[n]) - numpy.sum(u[n-1])) / numpy.sum(u[n])</span>
<span style="color:#75715e">#         n += 1</span>
        
    <span style="color:#66d9ef">return</span> u, v, p

mesh_size_x <span style="color:#f92672">=</span> <span style="color:#ae81ff">41</span>
mesh_size_y <span style="color:#f92672">=</span> <span style="color:#ae81ff">47</span>
rho <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
nu <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">1</span>
F <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
timesteps <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
dt <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">005</span>
sub_iterations <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>
x_domain <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>)
y_domain <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">2</span>)
x <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(x_domain[<span style="color:#ae81ff">0</span>], x_domain[<span style="color:#ae81ff">1</span>], mesh_size_x)
y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>linspace(y_domain[<span style="color:#ae81ff">0</span>], y_domain[<span style="color:#ae81ff">1</span>], mesh_size_y)
X, Y <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>meshgrid(x, y)
u_i <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
v_i <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
p_i <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>zeros((mesh_size_x, mesh_size_y))
u, v, p <span style="color:#f92672">=</span> channelFlow2D([x_domain, y_domain], mesh_size_x, mesh_size_y, timesteps, dt, u_i, v_i, p_i, F, rho, nu, sub_iterations)

fig <span style="color:#f92672">=</span> pyplot<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">5</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>)
pyplot<span style="color:#f92672">.</span>quiver(X[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>], Y[::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>], numpy<span style="color:#f92672">.</span>transpose(u[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, ::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>]), numpy<span style="color:#f92672">.</span>transpose(v[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, ::<span style="color:#ae81ff">2</span>, ::<span style="color:#ae81ff">2</span>]))
pyplot<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Student&#39;</span>)
</code></pre></div><p><img src="../CFDPython_files/2DChannelStud.svg" alt="svg"></p>
<p>I&rsquo;m cured!</p>
<p><code>*hic*</code> I&rsquo;m singin&rsquo; in the rain. <code>*hic*</code>
<code>*hic*</code> Just singin&rsquo; in the rain. <code>*hic*</code>
<code>*hic*</code> What a glorious feeling. <code>*hic*</code>
<code>*hic*</code> I&rsquo;m happy again. <code>*hic*</code>
<code>*hic*</code> I&rsquo;m laughin&rsquo; at clouds. <code>*hic*</code>
<code>*hic*</code> So dark up above. <code>*hic*</code></p>

	</article>
</main>

<div id="bottom-nav" class="text-center center-block">
	<a href=" https://godot-bloggy.xyz/" class="btn btn-default"><i class="fa fa-home"></i> Home</a>
</div>


  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "godotmisogi" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


						</div>
					</div>
				</div>
			</div>
		</div>
  </div>
   <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  
  <script src="https://godot-bloggy.xyz/js/App.js"></script>
  
  
  <script src="https://godot-bloggy.xyz/js/prism.js"></script>
  
  </body>
</html>
